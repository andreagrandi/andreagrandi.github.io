<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Andrea Grandi - Development</title>
        <link rel="stylesheet" href="https://www.andreagrandi.it/theme/css/main.css" />
        <link rel="stylesheet" href="https://www.andreagrandi.it/theme/tipuesearch/css/tipuesearch.css">
        <link href="https://www.andreagrandi.it/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Andrea Grandi RSS Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://www.andreagrandi.it/">Andrea Grandi</a></h1>
                <nav><ul>
    
                        <li><a href="https://www.andreagrandi.it/about/">About</a></li>
    
                        <li><a href="https://www.andreagrandi.it/curriculum/">Curriculum</a></li>
    
                        <li><a href="https://www.andreagrandi.it/pgp-key/">PGP Key</a></li>
                </ul>
<form id="search" action="https://www.andreagrandi.it/search.html" onsubmit="return validateForm(this.elements['q'].value);">
                        <input type="text" class="search-query" placeholder="" name="q" id="tipue_search_input">
                    </form>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://www.andreagrandi.it/2020/04/10/covid-api-free-and-open-source-api-service-for-covid19-data/">covid-api - a free and open source API service for COVID-19 data</a></h1>
<footer class="post-info">
        <span>Fri 10 April 2020</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/development.html">Development</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/covid.html">covid</a><a href="https://www.andreagrandi.it/tag/api.html">api</a><a href="https://www.andreagrandi.it/tag/rest.html">rest</a><a href="https://www.andreagrandi.it/tag/data.html">data</a><a href="https://www.andreagrandi.it/tag/covid-19.html">covid-19</a><a href="https://www.andreagrandi.it/tag/service.html">service</a><a href="https://www.andreagrandi.it/tag/free.html">free</a><a href="https://www.andreagrandi.it/tag/open.html">open</a><a href="https://www.andreagrandi.it/tag/source.html">source</a></span>
</footer><!-- /.post-info --><h2>Introduction</h2>
<p>In this period of COVID-19 emergency, many countries are publishing COVID related data that is being used by many existing projects and researchers.</p>
<p>The main problem with these data is that they are being released in CSV format on some GitHub repository. While we fully appreciate the opennes of this format, unfortunataly it can introduce an additional work to be done (downloading the data, cleaning it, importing the data into a database, keeping it updated etc...) before someone can consume and analyse the data.</p>
<h2>covid-api</h2>
<p>covid-api project is a <strong>free</strong> and <strong>open source</strong> API service which automatically imports the data from various sources (at the moment we support the <a href="https://github.com/CSSEGISandData/COVID-19">John Hopkins CSSE</a> data source) and makes it available as a REST API.</p>
<p>The service is still under development, but an initial version (with regularly updated data) is already available at <a href="https://api.covid19data.cloud">https://api.covid19data.cloud</a>.</p>
<h2>How to use the data</h2>
<p>To consume the API you don't need an account nor you need to authenticate in any way. You just need to request the right endpoint using the supported parameters.</p>
<p>Here is an example for Python language:</p>
<div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">requests</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.covid19data.cloud/v1/jh/daily-reports?last_update_from=2020-04-01&amp;last_update_to=2020-04-03&amp;country=Italy&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
<span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">35343</span><span class="p">,</span>
<span class="s1">&#39;country_region&#39;</span><span class="p">:</span> <span class="s1">&#39;Italy&#39;</span><span class="p">,</span>
<span class="s1">&#39;province_state&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">&#39;fips&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">&#39;admin2&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">&#39;last_update&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-04-01T21:58:34&#39;</span><span class="p">,</span>
<span class="s1">&#39;confirmed&#39;</span><span class="p">:</span> <span class="mi">110574</span><span class="p">,</span>
<span class="s1">&#39;deaths&#39;</span><span class="p">:</span> <span class="mi">13155</span><span class="p">,</span>
<span class="s1">&#39;recovered&#39;</span><span class="p">:</span> <span class="mi">16847</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">37895</span><span class="p">,</span>
<span class="s1">&#39;country_region&#39;</span><span class="p">:</span> <span class="s1">&#39;Italy&#39;</span><span class="p">,</span>
<span class="s1">&#39;province_state&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">&#39;fips&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">&#39;admin2&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="s1">&#39;last_update&#39;</span><span class="p">:</span> <span class="s1">&#39;2020-04-02T23:25:14&#39;</span><span class="p">,</span>
<span class="s1">&#39;confirmed&#39;</span><span class="p">:</span> <span class="mi">115242</span><span class="p">,</span>
<span class="s1">&#39;deaths&#39;</span><span class="p">:</span> <span class="mi">13915</span><span class="p">,</span>
<span class="s1">&#39;recovered&#39;</span><span class="p">:</span> <span class="mi">18278</span><span class="p">}]</span>
</pre></div>


<p>Further API documentation is available at https://api.covid19data.cloud/docs</p>
<h2>Next steps</h2>
<p>While we keep polishing the code and <a href="https://github.com/andreagrandi/covid-api/issues/43">improving the existing data import</a> procedure, we are planning to support additional data sources. The next one we are going to support is the <a href="https://github.com/andreagrandi/covid-api/issues/46"><strong>Italian Protezione Civile</strong></a>.</p>
<p>If you are aware of an additional data source that you would like to see covered, please let us know (creating a new Issue on GitHub) or send us a pull request.</p>
<h2>Contribute to the project</h2>
<p>If you are a Python developer and would like to contribute to the project, my advice is to first have a look at the main documentation available in the <a href="https://github.com/andreagrandi/covid-api/blob/master/README.md">README</a>.</p>
<p>Then I suggest to have a look at the existing <a href="https://github.com/andreagrandi/covid-api/issues">Issues</a> and see where help is needed or in alternative you can open a new Issue or send a pull request with fixes and improvements.</p>
<p>I also recommend to become familiar with our <a href="https://github.com/andreagrandi/covid-api/blob/master/CODE_OF_CONDUCT.md">Code of Conduct</a> before sending any contribution.</p>
<h2>Sponsors and Thanks</h2>
<p>I want to thank <a href="https://www.heroku.com/">Heroku</a> for accepting to sponsor the hosting of this service.</p>
<p>I also want to thank all the <a href="https://github.com/andreagrandi/covid-api/graphs/contributors">volunteers</a> involved in the project for their help and contributions.</p>
<h2>Disclaimer</h2>
<p>We are doing our best to keep the available data updated, clean (removing duplicates), and to provide a reliable service, 
but we are not in any way responsible for the accuracy of the data nor for the availability of the service itself. 
Please <strong>use it at your own risk</strong>.</p>
<p><strong>Abuse notice</strong>: we are currently not requiring any registration or authentication to use this service because 
we would like to keep it as simple as possible. 
Please do not abuse the service or you will force us to require a registration (subject to approval) to continue using it.</p><p><a href="https://www.andreagrandi.it/2020/04/10/covid-api-free-and-open-source-api-service-for-covid19-data/#disqus_thread">comments</a></p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.andreagrandi.it/2018/04/14/machine-learning-pima-indians-diabetes/" rel="bookmark"
                           title="Permalink to Machine Learning: Pima Indians Diabetes">Machine Learning: Pima Indians Diabetes</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Sat 14 April 2018</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/development.html">Development</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/machine-learning.html">Machine Learning</a><a href="https://www.andreagrandi.it/tag/python.html">Python</a><a href="https://www.andreagrandi.it/tag/scikit-learn.html">scikit-learn</a><a href="https://www.andreagrandi.it/tag/tutorial.html">tutorial</a></span>
</footer><!-- /.post-info -->                <p>Solving the Pima Indians Diabetes problem with Machine Learning using Python and scikit-learn</p>
                <a class="readmore" href="https://www.andreagrandi.it/2018/04/14/machine-learning-pima-indians-diabetes/">read more</a>
<p><a href="https://www.andreagrandi.it/2018/04/14/machine-learning-pima-indians-diabetes/#disqus_thread">comments</a></p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.andreagrandi.it/2017/08/25/getting-latest-ubuntu-ami-with-terraform/" rel="bookmark"
                           title="Permalink to Getting latest Ubuntu AMI with Terraform">Getting latest Ubuntu AMI with Terraform</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Fri 25 August 2017</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/development.html">Development</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/aws.html">AWS</a><a href="https://www.andreagrandi.it/tag/terraform.html">Terraform</a><a href="https://www.andreagrandi.it/tag/ubuntu.html">Ubuntu</a><a href="https://www.andreagrandi.it/tag/devops.html">devops</a></span>
</footer><!-- /.post-info -->                <p>When we need to create an EC2 resource on AWS using Terraform, we need to specify the AMI id to get the correct image.
The id is not easy to memorise and it changes depending on the zone we are working one. On every new release the id changes again.
So, how can we be sure to get the correct ID for our region, of the latest image available for a given Linux distribution?</p>
<h3>Getting latest Ubuntu AMI id</h3>
<p>In this example I will show how to get the ID for the latest version of Ubuntu 16.04 server, for the London region and create an EC2 instance using that ID.</p>
<div class="highlight"><pre><span></span><span class="na">variable &quot;aws_region&quot; { default</span> <span class="o">=</span> <span class="s2">&quot;eu-west-2&quot;</span> <span class=" -Punctuation">}</span><span class="c1"> # London</span>

<span class="kr">provider</span> <span class="s">&quot;aws&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    region</span> <span class="o">=</span> <span class="s2">&quot;${var.aws_region}&quot;</span>
<span class="na">    access_key</span> <span class="o">=</span> <span class="s2">&quot;youraccesskey&quot;</span>
<span class="na">    secret_key</span> <span class="o">=</span> <span class="s2">&quot;yoursecretkey&quot;</span>
<span class=" -Punctuation">}</span>

<span class="kr">data</span> <span class="s">&quot;aws_ami&quot; &quot;ubuntu&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    most_recent</span> <span class="o">=</span> <span class="kt">true</span>

    <span class="err">filter</span> <span class=" -Punctuation">{</span>
<span class="na">        name</span>   <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
<span class="na">        values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ubuntu/images/hvm-ssd/ubuntu-xenial-16.04-amd64-server-*&quot;</span><span class="p">]</span>
    <span class=" -Punctuation">}</span>

    <span class="err">filter</span> <span class=" -Punctuation">{</span>
<span class="na">        name</span>   <span class="o">=</span> <span class="s2">&quot;virtualization-type&quot;</span>
<span class="na">        values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hvm&quot;</span><span class="p">]</span>
    <span class=" -Punctuation">}</span>

<span class="na">    owners</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;099720109477&quot;</span><span class="p">]</span><span class="c1"> # Canonical</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;aws_instance&quot; &quot;web&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    ami</span>           <span class="o">=</span> <span class="s2">&quot;${data.aws_ami.ubuntu.id}&quot;</span>
<span class="na">    instance_type</span> <span class="o">=</span> <span class="s2">&quot;t2.micro&quot;</span>

    <span class="kd">tags</span> <span class=" -Punctuation">{</span>
<span class="na">        Name</span> <span class="o">=</span> <span class="s2">&quot;HelloUbuntu&quot;</span>
    <span class=" -Punctuation">}</span>
<span class=" -Punctuation">}</span>

<span class="kr">output</span> <span class="s">&quot;image_id&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    value</span> <span class="o">=</span> <span class="s2">&quot;${data.aws_ami.ubuntu.id}&quot;</span>
<span class=" -Punctuation">}</span>
</pre></div>


<p>After we have initialised our script using <strong>terraform init</strong> if we run it, we will get the AMI id and the instance will be created:</p>
<div class="highlight"><pre><span></span><span class="err">➜</span>  <span class="n">example1$</span><span class="p">:</span> <span class="n">terraform</span> <span class="n">apply</span>
<span class="k">data</span><span class="p">.</span><span class="n">aws_ami</span><span class="p">.</span><span class="n">ubuntu</span><span class="p">:</span> <span class="n">Refreshing</span> <span class="k">state</span><span class="p">...</span>
<span class="n">aws_instance</span><span class="p">.</span><span class="n">web</span><span class="p">:</span> <span class="n">Creating</span><span class="p">...</span>
    <span class="n">ami</span><span class="p">:</span>                          <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;ami-03998867&quot;</span>
    <span class="n">associate_public_ip_address</span><span class="p">:</span>  <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">availability_zone</span><span class="p">:</span>            <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">ebs_block_device</span><span class="p">.</span><span class="o">#</span><span class="p">:</span>           <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">ephemeral_block_device</span><span class="p">.</span><span class="o">#</span><span class="p">:</span>     <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">instance_state</span><span class="p">:</span>               <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">instance_type</span><span class="p">:</span>                <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;t2.micro&quot;</span>
    <span class="n">ipv6_address_count</span><span class="p">:</span>           <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">ipv6_addresses</span><span class="p">.</span><span class="o">#</span><span class="p">:</span>             <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">key_name</span><span class="p">:</span>                     <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">network_interface</span><span class="p">.</span><span class="o">#</span><span class="p">:</span>          <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">network_interface_id</span><span class="p">:</span>         <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">placement_group</span><span class="p">:</span>              <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">primary_network_interface_id</span><span class="p">:</span> <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">private_dns</span><span class="p">:</span>                  <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">private_ip</span><span class="p">:</span>                   <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">public_dns</span><span class="p">:</span>                   <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">public_ip</span><span class="p">:</span>                    <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">root_block_device</span><span class="p">.</span><span class="o">#</span><span class="p">:</span>          <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">security_groups</span><span class="p">.</span><span class="o">#</span><span class="p">:</span>            <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">source_dest_check</span><span class="p">:</span>            <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;true&quot;</span>
    <span class="n">subnet_id</span><span class="p">:</span>                    <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">tags</span><span class="p">.</span><span class="o">%</span><span class="p">:</span>                       <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;1&quot;</span>
    <span class="n">tags</span><span class="p">.</span><span class="n">Name</span><span class="p">:</span>                    <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;HelloUbuntu&quot;</span>
    <span class="n">tenancy</span><span class="p">:</span>                      <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">volume_tags</span><span class="p">.</span><span class="o">%</span><span class="p">:</span>                <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
    <span class="n">vpc_security_group_ids</span><span class="p">.</span><span class="o">#</span><span class="p">:</span>     <span class="ss">&quot;&quot;</span> <span class="o">=&gt;</span> <span class="ss">&quot;&lt;computed&gt;&quot;</span>
<span class="n">aws_instance</span><span class="p">.</span><span class="n">web</span><span class="p">:</span> <span class="n">Still</span> <span class="n">creating</span><span class="p">...</span> <span class="p">(</span><span class="mi">10</span><span class="n">s</span> <span class="n">elapsed</span><span class="p">)</span>
<span class="n">aws_instance</span><span class="p">.</span><span class="n">web</span><span class="p">:</span> <span class="n">Still</span> <span class="n">creating</span><span class="p">...</span> <span class="p">(</span><span class="mi">20</span><span class="n">s</span> <span class="n">elapsed</span><span class="p">)</span>
<span class="n">aws_instance</span><span class="p">.</span><span class="n">web</span><span class="p">:</span> <span class="n">Still</span> <span class="n">creating</span><span class="p">...</span> <span class="p">(</span><span class="mi">30</span><span class="n">s</span> <span class="n">elapsed</span><span class="p">)</span>
<span class="n">aws_instance</span><span class="p">.</span><span class="n">web</span><span class="p">:</span> <span class="n">Creation</span> <span class="n">complete</span> <span class="p">(</span><span class="n">ID</span><span class="p">:</span> <span class="n">i</span><span class="o">-</span><span class="mi">0</span><span class="n">f58f8bd55b3a7e38</span><span class="p">)</span>

<span class="n">Apply</span> <span class="n">complete</span><span class="o">!</span> <span class="n">Resources</span><span class="p">:</span> <span class="mi">1</span> <span class="n">added</span><span class="p">,</span> <span class="mi">0</span> <span class="n">changed</span><span class="p">,</span> <span class="mi">0</span> <span class="n">destroyed</span><span class="p">.</span>

<span class="n">Outputs</span><span class="p">:</span>

<span class="n">image_id</span> <span class="o">=</span> <span class="n">ami</span><span class="o">-</span><span class="mi">03998867</span>
</pre></div>


<p>That's all we need to spin up an EC2 instance on AWS using latest Ubuntu image available.</p>
                <a class="readmore" href="https://www.andreagrandi.it/2017/08/25/getting-latest-ubuntu-ami-with-terraform/">read more</a>
<p><a href="https://www.andreagrandi.it/2017/08/25/getting-latest-ubuntu-ami-with-terraform/#disqus_thread">comments</a></p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.andreagrandi.it/2017/08/17/creating-a-production-ready-api-with-python-and-django-rest-framework-part-4/" rel="bookmark"
                           title="Permalink to Creating a production ready API with Python and Django Rest Framework – part 4">Creating a production ready API with Python and Django Rest Framework – part 4</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Thu 17 August 2017</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/development.html">Development</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/api.html">API</a><a href="https://www.andreagrandi.it/tag/django.html">Django</a><a href="https://www.andreagrandi.it/tag/framework.html">framework</a><a href="https://www.andreagrandi.it/tag/python.html">Python</a><a href="https://www.andreagrandi.it/tag/rest.html">rest</a><a href="https://www.andreagrandi.it/tag/tutorial.html">tutorial</a></span>
</footer><!-- /.post-info -->                <p>In the <a href="https://www.andreagrandi.it/2017/1-creating-a-production-ready-api-with-python-and-django-rest-framework-part-3.md">previous
part</a>
of the tutorial we implemented <strong>details</strong> management, <strong>relations</strong>
between models, <strong>nested APIs</strong> and a different level of permissions.
Our API is basically complete but it is working properly? Is the source
code free of bugs? Would you feel confident to refactor the code without
breaking something? The answer to all our question is probably no. <strong>I
can't be sure if the code behaves properly nor I would feel confident
refactoring anything without having some tests coverage</strong>.</p>
<p>As I mentioned previously, we should have written tests since the
beginning, but I really didn't want to mix too many concepts together
and I wanted to let the user concentrate on the Rest Framework instead.</p>
<h3>Test structure and configuration</h3>
<p>Before beginning the fourth part of this tutorial, make sure you have
grabbed the latest source code
from <a href="https://github.com/andreagrandi/drf-tutorial">https://github.com/andreagrandi/drf-tutorial</a> and you have checked
out the previous git tag:</p>
<div class="highlight"><pre><span></span>git checkout tutorial-1.14
</pre></div>


<p>Django has an integrated test runner but my personal choice is to use
<a href="https://doc.pytest.org/en/latest/"><strong>pytest</strong></a>, so as first thing let's
install the needed libraries:</p>
<div class="highlight"><pre><span></span>pip install pytest pytest-django
</pre></div>


<p>As long as we respect a minimum of conventions (test files must start
with <strong>test_</strong> prefix), tests can be placed anywhere in the code. My
advice is to put them all together in a separate folder and divide them
according to app names. In our case we are going to create a folder
named "<strong>tests</strong>" at the same level of <strong>manage.py</strong> file. Inside this
folder we need to create a <strong>__init__.py</strong> file and another folder
called <strong>catalog</strong> with an additional <strong>__init__.py</strong> inside. Now,
still at the same level of <strong>manage.py</strong> create a file called
<strong>pytest.ini</strong> with this content:</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="n">pytest</span><span class="p">]</span>
<span class="n">DJANGO_SETTINGS_MODULE</span><span class="o">=</span><span class="n">drftutorial</span><span class="o">.</span><span class="n">settings</span>
</pre></div>


<p>Are you feeling confused? No problem. You can checkout the source code
containing these changes.</p>
<div class="highlight"><pre><span></span>git checkout tutorial-1.15
</pre></div>


<p>You can check if you have done everything correctly going inside the
drftutorial folder (the one containing <strong>manage.py</strong>) and launching
<strong>pytest</strong>. If you see something like this, you did your changes
correctly:</p>
<div class="highlight"><pre><span></span><span class="o">(</span>drf-tutorial<span class="o">)</span> ➜  drftutorial git:<span class="o">(</span>master<span class="o">)</span> <span class="nv">pytest</span>
<span class="o">=============================================================================================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">==============================================================================================================================</span>
platform darwin -- Python <span class="m">2</span>.7.13, pytest-3.0.6, py-1.4.32, pluggy-0.4.0
Django settings: drftutorial.settings <span class="o">(</span>from ini file<span class="o">)</span>
rootdir: /Users/andrea/Projects/drf-tutorial/drftutorial, inifile: pytest.ini
plugins: django-3.1.2
collected <span class="m">0</span> <span class="nv">items</span>

<span class="o">=========================================================================================================================</span> no tests ran in <span class="m">0</span>.01 <span class="nv">seconds</span> <span class="o">=========================================================================================================================</span>
<span class="o">(</span>drf-tutorial<span class="o">)</span> ➜  drftutorial git:<span class="o">(</span>master<span class="o">)</span>
</pre></div>


<h3>Writing the first test</h3>
<p>To begin with, I will show you how to write a simple test that will
verify if the API can return the products list. If you remember we
implemented this API in the first part of the tutorial. First of all
create a file called <strong>test_views.py</strong> under the folder
<strong>drftutorial/tests/catalog/</strong> and add this code:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">status</span>
<span class="kn">from</span> <span class="nn">rest_framework.test</span> <span class="kn">import</span> <span class="n">APITestCase</span>


<span class="k">class</span> <span class="nc">TestProductList</span><span class="p">(</span><span class="n">APITestCase</span><span class="p">):</span>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span>
    <span class="k">def</span> <span class="nf">test_can_get_product_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;product-list&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()),</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>


<p>before being able to run this test we need to change a little thing in
the <strong>catalog/urls.py</strong> file, something we should have done since the
beginning. Please change the first url in this way, adding the <strong>name</strong>
parameter:</p>
<div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^products/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ProductList</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;product-list&#39;</span><span class="p">),</span>
    <span class="o">...</span>
</pre></div>


<p>at this point we are able to run our test suite again and verify the
test is passing:</p>
<div class="highlight"><pre><span></span><span class="o">(</span>drf-tutorial<span class="o">)</span> ➜  drftutorial git:<span class="o">(</span>test-productlist<span class="o">)</span> ✗ pytest -v
<span class="o">=============================================================================================================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">==============================================================================================================================</span>
platform darwin -- Python <span class="m">2</span>.7.13, pytest-3.0.6, py-1.4.32, pluggy-0.4.0 -- /Users/andrea/.virtualenvs/drf-tutorial/bin/python2.7
cachedir: .cache
Django settings: drftutorial.settings <span class="o">(</span>from ini file<span class="o">)</span>
rootdir: /Users/andrea/Projects/drf-tutorial/drftutorial, inifile: pytest.ini
plugins: django-3.1.2
collected <span class="m">1</span> items

tests/catalog/test_views.py::TestProductList::test_can_get_product_list <span class="nv">PASSED</span>

<span class="o">===========================================================================================================================</span> <span class="m">1</span> passed in <span class="m">0</span>.98 <span class="nv">seconds</span> <span class="o">===========================================================================================================================</span>
</pre></div>


<p>To checkout the source code at this point:</p>
<div class="highlight"><pre><span></span>git checkout tutorial-1.16
</pre></div>


<h3>Explaining the test code</h3>
<p>When we implement a test, the first thing to do is to create a
<strong>test_*</strong> file and import the minimum necessary to write a test class
and method. Each test class must inherit from <strong>APITestCase</strong> and have a
name that start with <strong>Test</strong>, like <strong>TestProductList</strong>. Since we use
<a href="https://doc.pytest.org/en/latest/">pytest</a>, we need to mark our method
with <strong>@pytest.mark.django_db decorator</strong>, to tell the test suite our
code will explicitly access the database. We are going to use the <strong>client</strong> object
that is integrated in APITestCase to perform the request. Before doing that we
first get the local <strong>url</strong> using Django's <strong>reverse</strong> function. At this point
we do the call using the client:</p>
<div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>


<p>and then we assert a couple of things that we expect to be true:</p>
<div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()),</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>


<p>We check that our API returns the <strong>200</strong> status code and that in the returned
JSON there are 8 elements.</p>
<p>It's normally a good practice to create test data inside the tests, but in our case
we previously created a data migration that creates test data. Migrations are
run every time we run tests so when we call our API, the data will be already there.</p>
<h3>Wrapping up</h3>
<p>I've written a <a href="https://github.com/andreagrandi/drf-tutorial/blob/master/drftutorial/tests/catalog/test_views.py">few tests</a> 
for all the views we have implemented until now and they are available
if you checkout this version of the code:</p>
<div class="highlight"><pre><span></span>git checkout tutorial-1.17
</pre></div>


<p>I've only tested the views but it would be nice to test even the permission class, for example.
Please remember to write your tests first, if possible: implementing the code will be much more natural
once the tests are already in place.</p>
                <a class="readmore" href="https://www.andreagrandi.it/2017/08/17/creating-a-production-ready-api-with-python-and-django-rest-framework-part-4/">read more</a>
<p><a href="https://www.andreagrandi.it/2017/08/17/creating-a-production-ready-api-with-python-and-django-rest-framework-part-4/#disqus_thread">comments</a></p>                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 4
        <a href="https://www.andreagrandi.it/category/development2.html">&raquo;</a>
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://www.andreagrandi.it/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                            <li><a href="https://twitter.com/andreagrandi">twitter</a></li>
                            <li><a href="https://github.com/andreagrandi">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>
                    Powered by <a href="http://getpelican.com/">Pelican</a> and Python -
                    Source code available on <a href="https://github.com/andreagrandi/andreagrandi.it">GitHub</a>
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
                        <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" />
                    </a>
                </p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2140684-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'andrea-grandi-it';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>