<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Andrea Grandi - HowTo</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Andrea Grandi </a></h1>
                <nav><ul>
    
                        <li><a href="/about/">About</a></li>
    
                        <li><a href="/curriculum/">Curriculum</a></li>
    
                        <li><a href="/pgp-key/">PGP Key</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/2015/08/23/how-to-write-a-custom-django-middleware/">How to write a custom Django Middleware</a></h1>
<footer class="post-info">
        <span>Sun 23 August 2015</span>
<span>| tags: <a href="/tag/django.html">Django</a><a href="/tag/howto.html">HowTo</a><a href="/tag/middleware.html">middleware</a><a href="/tag/python.html">Python</a><a href="/tag/tutorial.html">tutorial</a></span>
</footer><!-- /.post-info --><p>To understand how a <strong><a href="https://docs.djangoproject.com/en/1.8/topics/http/middleware/">Django
Middleware</a></strong>
works we need to remember that the basic architecture of Django is
composed by a <strong>request</strong> and a <strong>response</strong>. A middleware is something
that stays in the middle. Let's give a look to the next diagram, taken
from official Django documentation:</p>
<p><a href="https://www.andreagrandi.it/wp-content/uploads/2015/08/middleware.png"><img alt="middleware" src="https://www.andreagrandi.it/wp-content/uploads/2015/08/middleware.png">{.aligncenter
.size-full .wp-image-1012 width="601"
height="511"}</a></p>
<h2>Important things to know</h2>
<p>There are four important things to know about middlewares:</p>
<ul>
<li>You need to write a class that just inherit from <strong><em>object</em></strong></li>
<li>The <strong>order</strong> where you place your middleware in <strong>settings.py</strong> is
    important: middlewares are processed from top to bottom during a
    request and from bottom to top during a response.</li>
<li>You don't need to implement all the available methods of a
    middleware. For example you can just implement <strong>process_request</strong>
    and <strong>process_template_response</strong></li>
<li>If you implement <strong>process_request</strong> and you decide to return an
    <strong>HttpResponse</strong>, all the other middlewares, views etc... will be
    ignored and only your response will be returned</li>
</ul>
<h2>Writing a middleware</h2>
<p>In my example I wanted to implement a feature that saves the time when a
request is made and the time when a request has been processed, then
calculates the time delta and exposes this value in the context so that
is accessible from our templates. How to implement a similar feature
using a middleware? Here is my example:</p>
<p>``` {.lang:python .decode:true}
from datetime import datetime</p>
<p>class BenchmarkMiddleware(object):
    def process_request(self, request):
        request._request_time = datetime.now()</p>
<div class="highlight"><pre><span></span>def process_template_response(self, request, response):
    response_time = request._request_time - datetime.now()
    response.context_data[&#39;response_time&#39;] = abs(response_time)
    return response
</pre></div>


<p>```</p>
<p>Please don't care about how I calculated the time. I'm aware that there
are better ways to do it, but I just wanted to keep it simple and show
how to implement a simple middleware.</p>
<p>If you want to see a <strong>complete example</strong> of a project that includes and
uses this middleware, here you can find the complete source
code: <a href="https://github.com/andreagrandi/benchmark-middleware-example">https://github.com/andreagrandi/benchmark-middleware-example</a></p>
<h2>References</h2>
<ul>
<li><a href="https://docs.djangoproject.com/en/1.8/topics/http/middleware/">https://docs.djangoproject.com/en/1.8/topics/http/middleware/</a></li>
<li><a href="http://agiliq.com/blog/2015/07/understanding-django-middlewares/">http://agiliq.com/blog/2015/07/understanding-django-middlewares/</a></li>
<li><a href="http://code.runnable.com/UrSGolK00ygpAAAQ/creating-a-custom-middleware-for-python-and-django">http://code.runnable.com/UrSGolK00ygpAAAQ/creating-a-custom-middleware-for-python-and-django</a></li>
</ul>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/2008/08/09/crepes-howto-come-preparare-le-crepes-alla-nutella/" rel="bookmark"
                           title="Permalink to Crepes HowTo: come preparare le crepes alla Nutella!">Crepes HowTo: come preparare le crepes alla Nutella!</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Sat 09 August 2008</span>
<span>| tags: <a href="/tag/crepes.html">crepes</a><a href="/tag/howto.html">HowTo</a><a href="/tag/laura.html">laura</a><a href="/tag/nutella.html">nutella</a><a href="/tag/ptlug.html">ptlug</a><a href="/tag/ricetta.html">ricetta</a></span>
</footer><!-- /.post-info -->                <p>Chi l'ha detto che all'interno di un
<a href="http://it.wikipedia.org/wiki/Linux_user_group">LUG</a> vengono realizzati
soltanto guide e howto tecnici? Anche i pinguini dovranno pur mangiare,
non trovate?</p>
<p>Grazie alla nostra pinguina Laura, il <a href="http://www.ptlug.org"><strong>PtLUG</strong></a>
è lieto di presentarvi il "<strong>Crepes HowTo</strong>", una video-guida che spiega
come preparare le <strong>crepes alla Nutella</strong>!</p>
<p>Gustatevi il video …</p>
                <a class="readmore" href="/2008/08/09/crepes-howto-come-preparare-le-crepes-alla-nutella/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/2008/04/17/installing-maemo-sdk-4-howto-updated/" rel="bookmark"
                           title="Permalink to Installing Maemo SDK 4 HowTo Updated">Installing Maemo SDK 4 HowTo Updated</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Thu 17 April 2008</span>
<span>| tags: <a href="/tag/chinook.html">chinook</a><a href="/tag/howto.html">HowTo</a><a href="/tag/maemo.html">maemo</a><a href="/tag/nokia.html">nokia</a><a href="/tag/sdk.html">SDK</a></span>
</footer><!-- /.post-info -->                <p>I've updated my previous howto that explain how to install [Maemo SDK 4
(Chinook)]{style="font-weight: bold;"}. The other howto was written when
Maemo SDK 4 Beta was out, now it's updated to
[4.0.1]{style="font-weight: bold;"} version of the SDK.</p>
<p>You can find it, as usual, on …</p>
                <a class="readmore" href="/2008/04/17/installing-maemo-sdk-4-howto-updated/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/2008/04/15/using-gtkiconview-in-python-a-small-tutorial/" rel="bookmark"
                           title="Permalink to Using GtkIconView in Python: a small tutorial">Using GtkIconView in Python: a small tutorial</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Tue 15 April 2008</span>
<span>| tags: <a href="/tag/gtk.html">gtk</a><a href="/tag/gtkiconview.html">gtkiconview</a><a href="/tag/gtkliststore.html">gtkliststore</a><a href="/tag/howto.html">HowTo</a><a href="/tag/programming.html">programming</a><a href="/tag/python.html">Python</a><a href="/tag/tutorial.html">tutorial</a></span>
</footer><!-- /.post-info -->                <p>In these days I was looking for a simple tutorial to understand how to
use <strong>GtkIconView</strong>, but the only thing I was able to find was an
example in PHP-Gtk. So I decided to translate it in <strong>Python</strong> language,
thinking it would be useful for other people trying to use …</p>
                <a class="readmore" href="/2008/04/15/using-gtkiconview-in-python-a-small-tutorial/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://twitter.com/andreagrandi">twitter</a></li>
                            <li><a href="https://github.com/andreagrandi">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>