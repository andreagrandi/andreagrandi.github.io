<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Andrea Grandi - encryption</title>
        <link rel="stylesheet" href="https://www.andreagrandi.it/theme/css/main.css" />
        <link rel="stylesheet" href="https://www.andreagrandi.it/theme/tipuesearch/css/tipuesearch.css">

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://www.andreagrandi.it/">Andrea Grandi </a></h1>
                <nav><ul>
    
                        <li><a href="https://www.andreagrandi.it/about/">About</a></li>
    
                        <li><a href="https://www.andreagrandi.it/curriculum/">Curriculum</a></li>
    
                        <li><a href="https://www.andreagrandi.it/pgp-key/">PGP Key</a></li>
                </ul>
<form id="search" action="https://www.andreagrandi.it/search.html" onsubmit="return validateForm(this.elements['q'].value);">
                        <input type="text" class="search-query" placeholder="" name="q" id="tipue_search_input">
                    </form>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://www.andreagrandi.it/2015/12/06/getting-a-free-ssl-certificate-from-letsencrypt-and-configuring-it-on-nginx-with-automatic-renewal/">Getting a free SSL certificate from Letsencrypt and configuring it on Nginx with automatic renewal</a></h1>
<footer class="post-info">
        <span>Sun 06 December 2015</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/devops-howto-linux.html">DevOps, HowTo, Linux</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/encryption.html">encryption</a><a href="https://www.andreagrandi.it/tag/letsencrypt.html">letsencrypt</a><a href="https://www.andreagrandi.it/tag/security.html">security</a><a href="https://www.andreagrandi.it/tag/ssl.html">ssl</a></span>
</footer><!-- /.post-info --><p>Finally <strong><a href="https://letsencrypt.org/">Letsencrypt</a></strong> went to <strong>public
beta</strong> and I really couldn't wait to use it on my VPS (where this blog
is hosted). Until few days ago I was using a <strong>free SSL</strong> certificate
from <a href="https://www.startssl.com/">StartSSL</a>. The service is nice and I'm
grateful to them for this important resource they are providing for
free, but it must be said that their renewal procedure isn't one of the
most user friendly.</p>
<p>For people who don't know the service yet, <strong>Letsencrypt</strong> not only
gives <strong>free SSL certificates</strong>, they also provide a command line tool
that people can use to request a new certificate or to renew an existing
one. This means that you don't have to worry anymore if/when your
certificate expires, you can set a crontab command and have the
certificate <strong>automatically renewed</strong> for you.</p>
<h2>Client installation</h2>
<p>To request a SSL certificate you need to install their command line
utility. Unless it has already been packaged for your distribution, for
the moment it's much easier to get it from git as they explain in their
<a href="https://letsencrypt.readthedocs.org/en/latest/using.html#installation">installation
instructions</a>:</p>
<p>``` {.lang:sh .decode:true}
git clone https://github.com/letsencrypt/letsencrypt
cd letsencrypt
./letsencrypt-auto</p>
<div class="highlight"><pre><span></span><span class="gh">Getting the SSL certificate</span>
<span class="gh">---------------------------</span>

There are a few different options available to request a certificate,
but the easiest one is to use the <span class="gs">**--webroot**</span> option, specifying the
document root of your website so that the client will be able to put
there a verification (temporary) file that will be served to the remote
service and used as verification method. In my case I only needed this
command:

<span class="s">``` {.lang:sh .decode:true}</span>
<span class="s">./letsencrypt-auto certonly --webroot -w /var/www/andreagrandi.it/ -d www.andreagrandi.it -d andreagrandi.it --email myemail@myprovider.com --renew-by-default --agree-tos</span>
</pre></div>


<p>Please note that I had to specify both www.andreagrandi.it and
andreagrandi.it as domains, otherwise it would have been invalid when
requesting just andreagrandi.it resources.</p>
<h2>Configuration files and certificates installation</h2>
<p>The command above will save all the configuration under
<strong>/etc/letsencrypt/</strong> and all the generated certificates under
<strong>/etc/letsencrypt/live/www.andreagrandi.it/*.pem</strong> (all the *.pem
files here are symbolic links to the current certificate). If you are
using <strong>Nginx</strong> the only files you need are <strong>fullchain.pem</strong> and
<strong>privkey.pem</strong> and you can set them in your Nginx configuration using
these two parameters:</p>
<p>``` {.lang:default .decode:true}
ssl_certificate /etc/letsencrypt/live/www.andreagrandi.it/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/www.andreagrandi.it/privkey.pem;</p>
<div class="highlight"><pre><span></span>In case you want to have a look at my full Nginx configuration file, as
reference, you can find it
here &lt;https://gist.github.com/andreagrandi/8b194c99cd3e77fdb5a8&gt;

Automatic renewal
-----------------

The last thing to be configured is a crontab rule to call the script
every... 2 months. Why 2 months? Letsencrypt SSL **certificates expire
in 3 months**. Usually SSL certificates are valid at least for 1 year,
but Letsencrypt decided to make it 3 months to incentivate the
automation of the renewal. I set it to 2 months, so if anything goes
wrong I still have plenty of time to do it manually. To edit crontab for
root user execute **crontab -e** and add this line:

``` {.lang:default .decode:true}
0 3 1 */2 * /root/letsencrypt/letsencrypt-auto certonly --webroot -w /var/www/andreagrandi.it/ -d www.andreagrandi.it -d andreagrandi.it --email email@domain.com --renew-by-default --agree-tos &amp;&amp; service nginx reload
</pre></div>


<p>Just a final note. You may have noticed that this website presents an
SSL certificate issued by COMODO. That's because I have
<strong><a href="https://www.cloudflare.com/">CloudFlare</a></strong> in front of my website and
that's how their SSL strict option works (at least for free plans).</p><p><a href="https://www.andreagrandi.it/2015/12/06/getting-a-free-ssl-certificate-from-letsencrypt-and-configuring-it-on-nginx-with-automatic-renewal/#disqus_thread">comments</a></p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.andreagrandi.it/2015/10/11/how-to-configure-encfs-on-osx-10-10-yosemite/" rel="bookmark"
                           title="Permalink to How to configure EncFS on OSX 10.10 (Yosemite)">How to configure EncFS on OSX 10.10 (Yosemite)</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Sun 11 October 2015</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/howto-osx-sicurezza.html">HowTo, OSX, Sicurezza</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/cloud.html">cloud</a><a href="https://www.andreagrandi.it/tag/encfs.html">encfs</a><a href="https://www.andreagrandi.it/tag/encryption.html">encryption</a><a href="https://www.andreagrandi.it/tag/osx.html">OSX</a><a href="https://www.andreagrandi.it/tag/security.html">security</a></span>
</footer><!-- /.post-info -->                <p>With <strong>EncFS</strong> it's possible to keep our data in almost any cloud
(Dropbox, OneDrive, etc...), having a good level of privacy and
security. Infact EncFS encrypt and decrypt our data automatically. It's
available for Linux as well and using a commercial solution (that is
currently unsupported) even on Windows.</p>
<h2>Installing EncFS</h2>
<p>EncFS can be installed from <strong>brew</strong>. If you don't have brew package
manager installed on OSX you can install it using this command:</p>
<p>``` {.lang:sh .decode:true}
ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</p>
<div class="highlight"><pre><span></span>After brew, you need to install **OSXFuse** from this
website &lt;http://osxfuse.github.io&gt;

Finally you can install **encfs** using this command:

``` {.lang:sh .decode:true}
brew install homebrew/fuse/encfs
</pre></div>


<h2>Configuring the encrypted folder</h2>
<p>Now that EncFS is installed, you can either mount an existing EncFS
volume or create a new one. In both cases the command is the same:</p>
<p>``` {.lang:sh .decode:true}
encfs ~/Dropbox/Private ~/Private</p>
<div class="highlight"><pre><span></span><span class="n">If</span> <span class="n">you</span> <span class="n">are</span> <span class="n">mounting</span> <span class="n">an</span> <span class="n">existing</span> <span class="n">encrypted</span> <span class="n">volume</span><span class="p">,</span> <span class="n">you</span> <span class="n">will</span> <span class="n">be</span> <span class="n">prompted</span>
<span class="k">for</span> <span class="n">the</span> <span class="n">password</span><span class="p">.</span> <span class="n">If</span> <span class="n">you</span> <span class="n">are</span> <span class="n">creating</span> <span class="n">a</span> <span class="n">new</span> <span class="n">encrypted</span> <span class="n">volume</span> <span class="n">you</span> <span class="n">will</span> <span class="n">be</span>
<span class="n">asked</span> <span class="n">some</span> <span class="n">questions</span> <span class="n">about</span> <span class="n">EncFS</span> <span class="n">parameters</span><span class="p">.</span>

<span class="o">**</span><span class="nl">Note</span><span class="p">:</span><span class="o">**</span> <span class="k">if</span> <span class="n">it</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">important</span> <span class="k">for</span> <span class="n">you</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">compatibility</span> <span class="n">with</span>
<span class="o">**</span><span class="p">[</span><span class="n">BoxCryptor</span> <span class="n">Classic</span><span class="p">](</span><span class="nl">https</span><span class="p">:</span><span class="c1">//www.boxcryptor.com/en/classic)** (in case</span>
<span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">use</span> <span class="n">the</span> <span class="n">same</span> <span class="n">volume</span> <span class="n">under</span> <span class="n">Windows</span><span class="p">),</span> <span class="n">please</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">this</span>
<span class="n">other</span> <span class="n">article</span> <span class="n">I</span>
<span class="nl">wrote</span><span class="p">:</span><span class="err"> </span><span class="o">&lt;</span><span class="nl">https</span><span class="p">:</span><span class="c1">//www.andreagrandi.it/2014/09/12/create-an-encfs-volume-compatible-with-boxcryptor-classic/&gt;</span>

<span class="n">Mount</span> <span class="n">the</span> <span class="n">encrypted</span> <span class="n">volume</span> <span class="n">on</span> <span class="n">startup</span>
<span class="o">-------------------------------------</span>

<span class="n">First</span> <span class="n">of</span> <span class="n">all</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">save</span> <span class="n">the</span> <span class="n">volume</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">password</span> <span class="n">inside</span> <span class="n">the</span> <span class="n">OSX</span>
<span class="n">keychain</span><span class="p">.</span> <span class="n">Open</span> <span class="n">the</span> <span class="n">app</span> <span class="o">**</span><span class="n">Keychain</span> <span class="n">Access</span><span class="o">**</span> <span class="n">and</span> <span class="n">create</span> <span class="n">a</span> <span class="n">new</span> <span class="n">entry</span> <span class="n">with</span>
<span class="n">name</span> <span class="o">**</span><span class="n">encfs</span><span class="o">**</span> <span class="n">and</span> <span class="n">account</span> <span class="n">value</span> <span class="o">**</span><span class="n">encfs</span><span class="o">**</span><span class="p">,</span> <span class="n">then</span> <span class="n">write</span> <span class="n">your</span> <span class="o">**</span><span class="n">password</span><span class="o">**</span>
<span class="n">and</span> <span class="n">click</span> <span class="o">**</span><span class="n">Add</span><span class="o">**:</span>

<span class="p">[</span><span class="o">!</span><span class="p">[</span><span class="n">encfs</span><span class="err">\</span><span class="n">_keychain</span><span class="err">\</span><span class="n">_access</span><span class="p">](</span><span class="nl">https</span><span class="p">:</span><span class="c1">//www.andreagrandi.it/wp-content/uploads/2015/10/encfs_keychain_access.png){.aligncenter</span>
<span class="p">.</span><span class="n">size</span><span class="o">-</span><span class="n">full</span> <span class="p">.</span><span class="n">wp</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mi">1052</span> <span class="n">width</span><span class="o">=</span><span class="s">&quot;428&quot;</span>
<span class="n">height</span><span class="o">=</span><span class="s">&quot;397&quot;</span><span class="p">}](</span><span class="nl">https</span><span class="p">:</span><span class="c1">//www.andreagrandi.it/wp-content/uploads/2015/10/encfs_keychain_access.png)</span>

<span class="n">Once</span> <span class="n">the</span> <span class="n">password</span> <span class="n">is</span> <span class="n">saved</span><span class="p">,</span> <span class="o">**</span><span class="n">open</span> <span class="n">a</span> <span class="n">text</span> <span class="n">editor</span><span class="o">**</span> <span class="n">and</span> <span class="n">paste</span> <span class="n">this</span> <span class="n">script</span>
<span class="n">and</span> <span class="n">save</span> <span class="n">it</span> <span class="n">as</span> <span class="o">**</span><span class="n">encfs</span><span class="err">\</span><span class="n">_mount</span><span class="p">.</span><span class="n">sh</span><span class="o">**</span> <span class="n">inside</span> <span class="n">your</span> <span class="o">**</span><span class="err">\$</span><span class="n">HOME</span><span class="o">**</span> <span class="nl">folder</span><span class="p">:</span>

<span class="err">```</span> <span class="p">{.</span><span class="nl">lang</span><span class="p">:</span><span class="n">sh</span> <span class="p">.</span><span class="nl">decode</span><span class="p">:</span><span class="nb">true</span><span class="p">}</span>
<span class="cp">#!/bin/bash</span>
<span class="cp"># Secure EncFS Dropbox mounter by Daniel Widerin &lt;daniel@widerin.net&gt;</span>

<span class="n">SOURCE</span><span class="o">=~/</span><span class="n">Dropbox</span><span class="o">/</span><span class="n">Private</span>
<span class="n">TARGET</span><span class="o">=~/</span><span class="n">Private</span>
<span class="n">VOLUME_TITLE</span><span class="o">=</span><span class="n">Private</span>
<span class="n">KEYCHAIN_PASSWORD</span><span class="o">=</span><span class="err">&#39;</span><span class="n">encfs</span><span class="err">&#39;</span>
<span class="n">ENCFS</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">encfs</span>

<span class="n">mount</span> <span class="o">|</span> <span class="n">grep</span> <span class="err">$</span><span class="n">TARGET</span> <span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="p">[[</span> <span class="s">&quot;$?&quot;</span> <span class="o">-</span><span class="n">eq</span> <span class="s">&quot;0&quot;</span> <span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">diskutil</span> <span class="n">unmount</span> <span class="err">$</span><span class="n">TARGET</span>

<span class="k">if</span> <span class="p">[</span> <span class="o">!</span> <span class="o">-</span><span class="n">d</span> <span class="err">$</span><span class="n">TARGET</span> <span class="p">];</span> <span class="n">then</span>
 <span class="n">echo</span> <span class="s">&quot;Create new mountpoint $TARGET&quot;</span>
 <span class="n">mkdir</span> <span class="err">$</span><span class="n">TARGET</span>
 <span class="n">chmod</span> <span class="mo">0700</span> <span class="err">$</span><span class="n">TARGET</span>
<span class="n">fi</span>

<span class="err">$</span><span class="n">ENCFS</span> <span class="err">$</span><span class="n">SOURCE</span> <span class="err">$</span><span class="n">TARGET</span> <span class="o">--</span><span class="n">extpass</span><span class="o">=</span><span class="s">&quot;security 2&gt;&amp;1 &gt;/dev/null find-generic-password -gl &#39;$KEYCHAIN_PASSWORD&#39; |grep password|cut -d </span><span class="se">\\\&quot;</span><span class="s"> -f 2&quot;</span> <span class="o">-</span><span class="n">ovolname</span><span class="o">=</span><span class="err">$</span><span class="n">VOLUME_TITLE</span>
</pre></div>


<p>Make it <strong>executable</strong>:</p>
<p>``` {.lang:sh .decode:true}
chmod +x ~/encfs_mount.sh</p>
<div class="highlight"><pre><span></span>Open **AppleScript** editor and paste this text inside and save as an
app in the \$HOME folder:

[![Screenshot 2015-10-11
19.27.14](https://www.andreagrandi.it/wp-content/uploads/2015/10/Screenshot-2015-10-11-19.27.14.png){.aligncenter
.size-full .wp-image-1055 width=&quot;484&quot;
height=&quot;392&quot;}](https://www.andreagrandi.it/wp-content/uploads/2015/10/Screenshot-2015-10-11-19.27.14.png)

``` {.lang:sh .decode:true}
do shell script &quot;$HOME/encfs_mount.sh&quot;
</pre></div>


<p>Finally, open "<strong>System Preferences</strong>" -&gt; "<strong>Users &amp; Groups</strong>" and
add the previously saved application.</p>
<p><a href="https://www.andreagrandi.it/wp-content/uploads/2015/10/Screenshot-2015-10-11-19.27.44.png"><img alt="Screenshot 2015-10-11
19.27.44" src="https://www.andreagrandi.it/wp-content/uploads/2015/10/Screenshot-2015-10-11-19.27.44.png">{.aligncenter
.size-full .wp-image-1056 width="463"
height="380"}</a></p>
<h2>Final notes</h2>
<p>At this point encfs is configured to be mounted at startup and to save
the encrypted files inside Dropbox. Please note: <strong>do not save anything
directly on \~/Dropbox/Private</strong>, only read and save your files from
\~/Private</p>
<h2>References</h2>
<ul>
<li><a href="https://www.maketecheasier.com/install-encfs-mac/">https://www.maketecheasier.com/install-encfs-mac/</a></li>
<li><a href="http://ninjatips.com/encrypt-dropbox-using-encfs/">http://ninjatips.com/encrypt-dropbox-using-encfs/</a></li>
</ul>
                <a class="readmore" href="https://www.andreagrandi.it/2015/10/11/how-to-configure-encfs-on-osx-10-10-yosemite/">read more</a>
<p><a href="https://www.andreagrandi.it/2015/10/11/how-to-configure-encfs-on-osx-10-10-yosemite/#disqus_thread">comments</a></p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.andreagrandi.it/2013/11/08/how-to-fix-encfs-installation-on-osx-10-9-mavericks-and-brew/" rel="bookmark"
                           title="Permalink to How to fix encfs installation on OSX 10.9 (Mavericks) and brew">How to fix encfs installation on OSX 10.9 (Mavericks) and brew</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Fri 08 November 2013</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/howto-osx-sicurezza.html">HowTo, OSX, Sicurezza</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/cloud.html">cloud</a><a href="https://www.andreagrandi.it/tag/encfs.html">encfs</a><a href="https://www.andreagrandi.it/tag/encryption.html">encryption</a><a href="https://www.andreagrandi.it/tag/fuse4x.html">fuse4x</a><a href="https://www.andreagrandi.it/tag/osx.html">OSX</a><a href="https://www.andreagrandi.it/tag/security.html">security</a></span>
</footer><!-- /.post-info -->                <p>After upgrading from OSX 10.8.x to 10.9 (Mavericks), <strong>encfs</strong> recipe is
broken. First of all you have to fix a problem with a library header:</p>
<div class="highlight"><pre><span></span>sudo ln -s /usr/include/sys/_endian.h /usr/include/sys/endian.h
</pre></div>


<p>then you can install encfs using this remote brew recipe:</p>
<div class="highlight"><pre><span></span>brew reinstall https://gist.github.com/ghibble/7297078/raw/cae1ff000a5e1cfc670f5b7a611279ed494b63af/encfs.rb
</pre></div>


<p>It's also possible that you have to fix fuse4x installation before being
able to use encfs (I had to do it):</p>
<div class="highlight"><pre><span></span>sudo /bin/cp -rfX /usr/local/Cellar/fuse4x-kext/0.9.2/Library/Extensions/fuse4x.kext /Library/Extensions
sudo chmod +s /Library/Extensions/fuse4x.kext/Support/load_fuse4x
</pre></div>


<p>That's it! Please note that this is just a workaround (thanks to
<strong>Giovanni Bajo</strong> for suggesting me the symlink fix). Please also note
that this recipe uses fuse4x library and not the most updated osxfuse
(but it works, anyway). Some other users reported me that there is a fix
for the original brew recipe, and this one uses osxfuse. You can find it
here <a href="https://gist.github.com/defunctzombie/7324625">https://gist.github.com/defunctzombie/7324625</a> but I haven't
tested it yet.</p>
<p><strong>Update:</strong> to fully integrate encfs with OSX, I also suggest to follow
this nice guide <a href="http://www.maketecheasier.com/install-encfs-mac/">http://www.maketecheasier.com/install-encfs-mac/</a></p>
                <a class="readmore" href="https://www.andreagrandi.it/2013/11/08/how-to-fix-encfs-installation-on-osx-10-9-mavericks-and-brew/">read more</a>
<p><a href="https://www.andreagrandi.it/2013/11/08/how-to-fix-encfs-installation-on-osx-10-9-mavericks-and-brew/#disqus_thread">comments</a></p>                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://twitter.com/andreagrandi">twitter</a></li>
                            <li><a href="https://github.com/andreagrandi">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>
                    Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
                        <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" />
                    </a>
                </p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'andrea-grandi-it';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>