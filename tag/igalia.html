<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Andrea Grandi - Igalia</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Andrea Grandi </a></h1>
                <nav><ul>
    
                        <li><a href="/about/">About</a></li>
    
                        <li><a href="/curriculum/">Curriculum</a></li>
    
                        <li><a href="/pgp-key/">PGP Key</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/2009/08/06/writing-python-bindings-of-existing-c-libraries-%e2%80%93-2-%e2%80%93-a-simple-example-of-binding/">Writing Python bindings of existing C libraries – (2) – A simple example of binding</a></h1>
<footer class="post-info">
        <span>Thu 06 August 2009</span>
<span>| tags: <a href="/tag/binding.html">binding</a><a href="/tag/igalia.html">Igalia</a><a href="/tag/maemo.html">maemo</a><a href="/tag/python.html">Python</a></span>
</footer><!-- /.post-info --><h2>Introduction</h2>
<p>As I promised in the preceding post, I'll provide a very easy example of
a python binding. Let's suppose we don't want to use the methods
included in Python to sum two integer values and we want to do it in C
and then call the add method from a python script. I'll write the
complete source code first and then I'll explain all the parts of it.</p>
<h2>Source Code</h2>
<p>[sourcecode language="C"]<br>
#include &lt;Python.h&gt;</p>
<p>static PyObject *foo_add(PyObject *self, PyObject *args)<br>
{<br>
int a;<br>
int b;</p>
<p>if (!PyArg_ParseTuple(args, "ii", &amp;a, &amp;b))<br>
{<br>
return NULL;<br>
}</p>
<p>return Py_BuildValue("i", a + b);<br>
}</p>
<p>static PyMethodDef foo_methods[] = {<br>
{ "add", (PyCFunction)foo_add, METH_VARARGS, NULL },<br>
{ NULL, NULL, 0, NULL }<br>
};</p>
<p>PyMODINIT_FUNC initfoo()<br>
{<br>
Py_InitModule3("foo", foo_methods, "My first extension module.");<br>
}<br>
[/sourcecode]</p>
<h2>How it works</h2>
<p>First of all we have to include <strong>Python.h</strong> in our C file. This allows
us to write an extension for Python language. To be able to include this
header, we must have the python development packages installed in our
system. For example in Debian based distributions we can install them
with this command:</p>
<p><code>sudo apt-get install python2.5-dev</code></p>
<p>Every module has at least three parts. In the first part we write
methods we want to call from the final python module: in this case we
have a method called <strong>foo_add</strong> where "<em>foo</em>" is the name of the
module and "<em>add</em>" the name of the method. Every method is declared as
<strong>static PyObject</strong>. The method does anything particular except calling
PyArg_ParseTuple to validate the input (we'll discuss this later),
adding the two passed numbers and returning the result.</p>
<p>In the second part we have something like a dictionary, defined as
static <strong>PyMethodDef</strong> and called foo_methods (where "foo" again is the
name of the module). For each method we want to expose in our python
module, we have to add something like this:</p>
<p><code>{"add", (PyCFunction)foo_add, METH_VARARGS, NULL}</code></p>
<p>where "<em>add</em>" is the name of the method we want to be visible in our
module, <em>(PyCFunction)foo_add</em> is a pointer to our foo_add method,
implemented in the C module, METH_VARARGS means that we want to pass
some parameters to the function and the last one would be the
description of the method (we can leave it NULL if we want).</p>
<p>Third part allows us to register the defined method/s and the module:</p>
<p><code>Py_InitModule3("foo", foo_methods, "My first extension module.");</code></p>
<h3>Parsing Parameters</h3>
<p>The <strong>PyArg_ParseTuple</strong> function extracts arguments from the
<strong>PyObject</strong> passed as parameter to the current method and follows
almost the sscanf syntax to parse parameters (in this case we had <em>"ii"</em>
for two integers). You can fin the complete reference here:
<a href="http://docs.python.org/c-api/arg.html">http://docs.python.org/c-api/arg.html</a></p>
<h2>Building and installing</h2>
<p>To build the module, we have to be in the source directory and execute
this command:</p>
<p><code>gcc -shared -I/usr/include/python2.5 foo.c -o foo.so</code></p>
<p>then we've to copy the generated module to the python's modules
directory:</p>
<p><code>cp foo.so /usr/lib/python2.5/site-packages/</code></p>
<h2>Testing our module</h2>
<p>Testing the module is really easy. We've to start a python shell or
create a python script with the following source code:</p>
<p>[sourcecode language="python"]<br>
import foo<br>
print foo.add(2, 3)<br>
[/sourcecode]</p>
<p>if all is working fine, the printed result should be <strong>5</strong></p>
<h2>References</h2>
<ul>
<li><a href="http://docs.python.org/extending/extending.html">http://docs.python.org/extending/extending.html</a></li>
<li><a href="http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596543.html">http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596543.html</a></li>
</ul>
<div id="_mcePaste"
style="overflow: hidden; position: absolute; left: -10000px; top: 399px; width: 1px; height: 1px;">

python2.5-dev

</div>

<div id="_mcePaste"
style="overflow: hidden; position: absolute; left: -10000px; top: 399px; width: 1px; height: 1px;">

python2.5-dev

</div>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/2009/08/03/writing-python-bindings-of-existing-c-libraries-1-introduction/" rel="bookmark"
                           title="Permalink to Writing Python bindings of existing C libraries - (1) - Introduction">Writing Python bindings of existing C libraries - (1) - Introduction</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Mon 03 August 2009</span>
<span>| tags: <a href="/tag/bindings.html">bindings</a><a href="/tag/c.html">C</a><a href="/tag/igalia.html">Igalia</a><a href="/tag/libraries.html">libraries</a><a href="/tag/library.html">library</a><a href="/tag/maemo.html">maemo</a><a href="/tag/pymaemo.html">pymaemo</a><a href="/tag/python.html">Python</a></span>
</footer><!-- /.post-info -->                <p>This summer I'm having the pleasure of working in
<a href="http://www.igalia.com"><strong>Igalia</strong></a> (a spanish free software company)
for a couple of months and they assigned me to an interesting project:
developing <strong>Python bindings</strong> for <strong>MAFW</strong> library (a <strong>Maemo</strong>
multimedia library that will be used in <strong>Fremantle</strong> release).</p>
<p>Having the opportunity to work …</p>
                <a class="readmore" href="/2009/08/03/writing-python-bindings-of-existing-c-libraries-1-introduction/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/2009/07/25/i-officially-joined-the-pymaemo-team/" rel="bookmark"
                           title="Permalink to I officially joined the PyMaemo team">I officially joined the PyMaemo team</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Sat 25 July 2009</span>
<span>| tags: <a href="/tag/bindings.html">bindings</a><a href="/tag/freemantle.html">freemantle</a><a href="/tag/igalia.html">Igalia</a><a href="/tag/maemo.html">maemo</a><a href="/tag/python.html">Python</a></span>
</footer><!-- /.post-info -->                <p>This summer I'm working for 2 months at <a href="http://www.igalia.com">Igalia</a>,
a spanish free software company, and they assigned me the project of
writing a <strong>Python binding</strong> for <strong>MAFW</strong> (a new multimedia library that
will be included in <strong>Freemantle</strong>).</p>
<p>After few days I discovered that
<a href="http://garage.maemo.org/projects/pymaemo/"><strong>PyMaemo</strong></a> team was
already working to it …</p>
                <a class="readmore" href="/2009/07/25/i-officially-joined-the-pymaemo-team/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://twitter.com/andreagrandi">twitter</a></li>
                            <li><a href="https://github.com/andreagrandi">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>