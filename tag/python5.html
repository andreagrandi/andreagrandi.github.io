<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Andrea Grandi - python</title>
        <link rel="stylesheet" href="https://www.andreagrandi.it/theme/css/main.css" />
        <link rel="stylesheet" href="https://www.andreagrandi.it/theme/tipuesearch/css/tipuesearch.css">
        <link href="https://www.andreagrandi.it/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Andrea Grandi RSS Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://www.andreagrandi.it/">Andrea Grandi </a></h1>
                <nav><ul>
    
                        <li><a href="https://www.andreagrandi.it/about/">About</a></li>
    
                        <li><a href="https://www.andreagrandi.it/curriculum/">Curriculum</a></li>
    
                        <li><a href="https://www.andreagrandi.it/pgp-key/">PGP Key</a></li>
                </ul>
<form id="search" action="https://www.andreagrandi.it/search.html" onsubmit="return validateForm(this.elements['q'].value);">
                        <input type="text" class="search-query" placeholder="" name="q" id="tipue_search_input">
                    </form>
                </nav>
        </header><!-- /#banner -->

                <section id="content" class="body">
                    <ol id="posts-list" class="hfeed" start="3">
            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.andreagrandi.it/2015/10/11/reversing-a-list-in-python/" rel="bookmark"
                           title="Permalink to Reversing a List in Python">Reversing a List in Python</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Sun 11 October 2015</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/development.html">Development</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/lists.html">lists</a><a href="https://www.andreagrandi.it/tag/python.html">Python</a><a href="https://www.andreagrandi.it/tag/reversed.html">reversed</a></span>
</footer><!-- /.post-info -->                <p>Sometimes we need to reverse the order of the elements in a Python list.
While there can be many different ways of implementing this task, I
found three in particular that I appreciate for different reasons. Let's
define first a list of integers that we will reverse later.</p>
<div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</pre></div>


<h3>List slicing</h3>
<p>This method can be a bit obscure at first read, but basically it slices
the whole list proceding in the reverse order:</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">input</span><span class="p">]:</span> <span class="nb">print</span> <span class="n">l</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">[</span><span class="n">output</span><span class="p">]:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>


<h3>Reversed method</h3>
<p>We use the
<strong><a href="https://docs.python.org/2/library/functions.html#reversed">reversed</a></strong> method
that returns an iterable object and a list comprehension to generate the
new list</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">input</span><span class="p">]:</span> <span class="nb">print</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
<span class="p">[</span><span class="n">output</span><span class="p">]:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>


<h3>Swapping values in place</h3>
<p>This last method is more verbose and it basically divides the list in
two parts and swaps the first with sixth, the second with fifth, etc...</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">input</span><span class="p">]:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="nb">print</span> <span class="n">l</span>

<span class="p">[</span><span class="n">output</span><span class="p">]:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
                <a class="readmore" href="https://www.andreagrandi.it/2015/10/11/reversing-a-list-in-python/">read more</a>
<p><a href="https://www.andreagrandi.it/2015/10/11/reversing-a-list-in-python/#disqus_thread">comments</a></p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.andreagrandi.it/2015/08/31/understanding-python-decorators-optimizing-a-recursive-fibonacci-implementation/" rel="bookmark"
                           title="Permalink to Understanding Python decorators optimizing a recursive Fibonacci implementation">Understanding Python decorators optimizing a recursive Fibonacci implementation</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Mon 31 August 2015</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/programmazione-python.html">Programmazione, Python</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/decorators.html">decorators</a><a href="https://www.andreagrandi.it/tag/fibonacci.html">fibonacci</a><a href="https://www.andreagrandi.it/tag/memoization.html">memoization</a><a href="https://www.andreagrandi.it/tag/memoize.html">memoize</a><a href="https://www.andreagrandi.it/tag/optimization.html">optimization</a><a href="https://www.andreagrandi.it/tag/python.html">Python</a></span>
</footer><!-- /.post-info -->                <p>A <strong>decorator</strong> is a Python function that takes a <em>function object</em> as
an argument and returns a function as a <em>value</em>. Here is an example of
decorator definition:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="c1"># make a new function</span>
    <span class="k">def</span> <span class="nf">new_function</span><span class="p">():</span>
        <span class="c1"># some code</span>

    <span class="k">return</span> <span class="n">new_function</span>
</pre></div>


<p>To apply a decorator to an existing function, you just need to put
<strong>@*decorator_name</strong>* in the line before its definition, like this
example:</p>
<div class="highlight"><pre><span></span><span class="nd">@foo</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="nb">print</span> <span class="s1">&#39;Hello World&#39;</span>
</pre></div>


<p>This decorator doesn't do anything, so let's think about a more concrete
problem we could solve using decorators.</p>
<h2>Fibonacci sequence</h2>
<p>By definition, the first two numbers in the
<strong><a href="https://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci</a></strong> sequence
are either 1 and 1 or 0 and 1. All the other numbers are the sum of the
previous two numbers of the sequence. Example:</p>
<ol>
<li>0, 1: the third number is 1</li>
<li>0, 1, 1: the fourth number is 2</li>
<li>0, 1, 1, 2: the fifth number is 3</li>
<li>0, 1, 1, 2, 3: the sixth number is 5</li>
<li>etc...</li>
</ol>
<p>If we wanted to give a <strong>math definition</strong> of the sequence, we could
describe it in this way:</p>
<ul>
<li><strong>F(0): 0</strong></li>
<li><strong>F(1): 1</strong></li>
<li><strong>F(n): F(n-1) + F(n-2)</strong></li>
</ul>
<p>In <strong>Python</strong> we could have a <strong>recursive function</strong> like the following
one:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>


<p>What's the problem with this implementation? The code works as expected,
but it's very <strong>inefficient</strong>. The next picture will explain what
happens when we will try, for example, to calculate the 5th number of
the sequence:</p>
<p><a href="https://www.andreagrandi.it/images/2015/08/fibo.png"><img alt="fibo" src="https://www.andreagrandi.it/images/2015/08/fibo.png" width="60%"></a></p>
<p>Fib(5) is Fib(4) + Fib(3), but Fib(4) itself is Fib(3) + Fib(2), and...
the picture just tell us that we have calculated Fib(3) 2 times, Fib(2)
3 times, Fib(1) 5 times! Why are we repeating the same operation every
time if we already calculated the result?</p>
<h2>Memoization</h2>
<blockquote>
<p>In computing, <strong>memoization</strong> is an optimization technique used
primarily to speed up computer programs by storing the results of
expensive function calls and returning the cached result when the same
inputs occur again.</p>
</blockquote>
<p>We need to store values of the sequence we have already calculated and
get them later when we need them. Let's implement a simple memoization
decorator:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">memoize</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">args</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">args</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">decorated_function</span>
</pre></div>


<p>The decorator defines a dict at the beginning that is used as a cache.
When we want to find the n number of the sequence, it first checks if
the value was already calculated and that value is returned instead of
being calculated again. If the value is not found, then the original
function is being called and then the value is store in the cache, then
returned to the caller.</p>
<h2>Using the memoize decorator</h2>
<p>How much this decorator can speed up our fib method? Let's try to
benchmark the execution using Python
<strong><a href="https://docs.python.org/2/library/timeit.html">timeit</a></strong> module.</p>
<div class="highlight"><pre><span></span><span class="c1"># First example, not using the memoize decorator</span>

<span class="kn">import</span> <span class="nn">timeit</span>

<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s2">&quot;fib(35)&quot;</span><span class="p">,</span> <span class="s2">&quot;from __main__ import fib&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">t1</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>The required time to calculate the 35th number of the Fibonacci sequence
on my laptop is: <strong>4.73480010033</strong></p>
<div class="highlight"><pre><span></span><span class="c1"># Second example, using the memoize decorator</span>

<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">from</span> <span class="nn">memoize</span> <span class="kn">import</span> <span class="n">memoize</span>  <span class="c1"># For convenience I put my decorator</span>
                            <span class="c1"># in a module named memoize.py</span>

<span class="nd">@memoize</span>
<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s2">&quot;fib(35)&quot;</span><span class="p">,</span> <span class="s2">&quot;from __main__ import fib&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">t1</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>The required time to calculate the 35th number of the Fibonacci sequence
on my laptop is: <strong>0.000133037567139</strong></p>
<p>Quite faster, don't you think? I will let you try how long does it take
to calculate the 60th number of the sequence with and without using the
decorator. <strong>Hint:</strong> grab a cup of coffee before beginning!</p>
                <a class="readmore" href="https://www.andreagrandi.it/2015/08/31/understanding-python-decorators-optimizing-a-recursive-fibonacci-implementation/">read more</a>
<p><a href="https://www.andreagrandi.it/2015/08/31/understanding-python-decorators-optimizing-a-recursive-fibonacci-implementation/#disqus_thread">comments</a></p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.andreagrandi.it/2015/08/29/django-notes-read-values-from-settings-in-a-safe-way/" rel="bookmark"
                           title="Permalink to Django Notes: read values from settings in a safe way">Django Notes: read values from settings in a safe way</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Sat 29 August 2015</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/django-howto-programmazione-python.html">Django, HowTo, Programmazione, Python</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/django.html">Django</a><a href="https://www.andreagrandi.it/tag/getattr.html">getattr</a><a href="https://www.andreagrandi.it/tag/python.html">Python</a><a href="https://www.andreagrandi.it/tag/settings.html">settings</a></span>
</footer><!-- /.post-info -->                <p>Working on <strong>Django</strong> projects I find very often that many developers
access the values that are defined in <strong>settings</strong> in this way</p>
<p>``` {.lang:python .decode:true}
from django.conf import settings</p>
<p>my_value = settings.MY_SETTING</p>
<div class="highlight"><pre><span></span><span class="n">What</span> <span class="n">happens</span> <span class="k">if</span> <span class="o">**</span><span class="n">MY</span>\<span class="n">_SETTING</span><span class="o">**</span> <span class="n">has</span> <span class="ow">not</span> <span class="n">been</span> <span class="n">defined</span> <span class="ow">in</span> <span class="o">**</span><span class="n">settings</span><span class="o">.</span><span class="n">py</span><span class="o">**</span><span class="err">?</span>
<span class="n">The</span> <span class="n">code</span> <span class="n">will</span> <span class="k">raise</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">and</span> <span class="n">crash</span><span class="p">,</span> <span class="n">of</span> <span class="n">course</span><span class="o">.</span> <span class="n">How</span> <span class="n">can</span> <span class="n">we</span> <span class="n">make</span> <span class="n">the</span>
<span class="n">code</span> <span class="n">more</span> <span class="n">reliable</span><span class="err">?</span> <span class="n">We</span> <span class="n">could</span> <span class="o">*</span><span class="k">try</span><span class="o">/</span><span class="k">except</span><span class="o">*</span> <span class="n">the</span> <span class="n">code</span> <span class="n">block</span> <span class="n">that</span> <span class="n">tries</span> <span class="n">to</span>
<span class="n">read</span> <span class="n">the</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">maybe</span> <span class="nb">set</span> <span class="n">a</span> <span class="n">value</span> <span class="k">if</span> <span class="n">we</span> <span class="n">get</span> <span class="n">an</span> <span class="n">exception</span><span class="p">,</span> <span class="n">but</span> <span class="n">this</span>
<span class="n">would</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">a</span> <span class="n">clean</span> <span class="n">way</span> <span class="n">to</span> <span class="n">do</span> <span class="n">this</span> <span class="n">job</span><span class="o">.</span>

<span class="n">A</span> <span class="n">cleaner</span> <span class="n">way</span> <span class="n">to</span> <span class="n">do</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">to</span> <span class="n">use</span> <span class="o">**</span><span class="nb">getattr</span><span class="o">**</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">way</span><span class="p">:</span>

<span class="sb">``</span><span class="err">`</span> <span class="p">{</span><span class="o">.</span><span class="n">lang</span><span class="p">:</span><span class="n">python</span> <span class="o">.</span><span class="n">decode</span><span class="p">:</span><span class="n">true</span><span class="p">}</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>

<span class="n">my_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s1">&#39;MY_SETTING&#39;</span><span class="p">,</span> <span class="s1">&#39;my-default-value&#39;</span><span class="p">)</span>
</pre></div>


<p><strong>getattr</strong> will try to read <strong>MY_SETTING</strong> value from <strong>settings.py</strong>,
if the value doesn't exist <strong>my_value</strong> will be assigned with
<strong>my-default-value</strong>.</p>
                <a class="readmore" href="https://www.andreagrandi.it/2015/08/29/django-notes-read-values-from-settings-in-a-safe-way/">read more</a>
<p><a href="https://www.andreagrandi.it/2015/08/29/django-notes-read-values-from-settings-in-a-safe-way/#disqus_thread">comments</a></p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.andreagrandi.it/2015/08/23/how-to-write-a-custom-django-middleware/" rel="bookmark"
                           title="Permalink to How to write a custom Django Middleware">How to write a custom Django Middleware</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Sun 23 August 2015</span>
	        <span>| in <a href="https://www.andreagrandi.it/category/development.html">Development</a></span>
<span>| tags: <a href="https://www.andreagrandi.it/tag/django.html">Django</a><a href="https://www.andreagrandi.it/tag/howto.html">HowTo</a><a href="https://www.andreagrandi.it/tag/middleware.html">middleware</a><a href="https://www.andreagrandi.it/tag/python.html">Python</a><a href="https://www.andreagrandi.it/tag/tutorial.html">tutorial</a></span>
</footer><!-- /.post-info -->                <p>To understand how a <strong><a href="https://docs.djangoproject.com/en/1.8/topics/http/middleware/">Django
Middleware</a></strong>
works we need to remember that the basic architecture of Django is
composed by a <strong>request</strong> and a <strong>response</strong>. A middleware is something
that stays in the middle. Let's give a look to the next diagram, taken
from official Django documentation:</p>
<p><a href="https://www.andreagrandi.it/images/2015/08/middleware.png"><img alt="middleware" src="https://www.andreagrandi.it/images/2015/08/middleware.png" width="100%"></a></p>
<h3>Important things to know</h3>
<p>There are four important things to know about middlewares:</p>
<ul>
<li>You need to write a class that just inherit from <strong><em>object</em></strong></li>
<li>The <strong>order</strong> where you place your middleware in <strong>settings.py</strong> is
    important: middlewares are processed from top to bottom during a
    request and from bottom to top during a response.</li>
<li>You don't need to implement all the available methods of a
    middleware. For example you can just implement <strong>process_request</strong>
    and <strong>process_template_response</strong></li>
<li>If you implement <strong>process_request</strong> and you decide to return an
    <strong>HttpResponse</strong>, all the other middlewares, views etc... will be
    ignored and only your response will be returned</li>
</ul>
<h3>Writing a middleware</h3>
<p>In my example I wanted to implement a feature that saves the time when a
request is made and the time when a request has been processed, then
calculates the time delta and exposes this value in the context so that
is accessible from our templates. How to implement a similar feature
using a middleware? Here is my example:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>


<span class="k">class</span> <span class="nc">BenchmarkMiddleware</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">request</span><span class="o">.</span><span class="n">_request_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">process_template_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">response_time</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">_request_time</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">response</span><span class="o">.</span><span class="n">context_data</span><span class="p">[</span><span class="s1">&#39;response_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">response_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>
</pre></div>


<p>Please don't care about how I calculated the time. I'm aware that there
are better ways to do it, but I just wanted to keep it simple and show
how to implement a simple middleware.</p>
<p>If you want to see a <strong>complete example</strong> of a project that includes and
uses this middleware, here you can find the complete source
code: <a href="https://github.com/andreagrandi/benchmark-middleware-example">https://github.com/andreagrandi/benchmark-middleware-example</a></p>
<h3>References</h3>
<ul>
<li><a href="https://docs.djangoproject.com/en/1.8/topics/http/middleware/">https://docs.djangoproject.com/en/1.8/topics/http/middleware/</a></li>
<li><a href="http://agiliq.com/blog/2015/07/understanding-django-middlewares/">http://agiliq.com/blog/2015/07/understanding-django-middlewares/</a></li>
<li><a href="http://code.runnable.com/UrSGolK00ygpAAAQ/creating-a-custom-middleware-for-python-and-django">http://code.runnable.com/UrSGolK00ygpAAAQ/creating-a-custom-middleware-for-python-and-django</a></li>
</ul>
                <a class="readmore" href="https://www.andreagrandi.it/2015/08/23/how-to-write-a-custom-django-middleware/">read more</a>
<p><a href="https://www.andreagrandi.it/2015/08/23/how-to-write-a-custom-django-middleware/#disqus_thread">comments</a></p>                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
        <a href="https://www.andreagrandi.it/tag/python4.html">&laquo;</a>
    Page 5 / 9
        <a href="https://www.andreagrandi.it/tag/python6.html">&raquo;</a>
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://www.andreagrandi.it/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                            <li><a href="https://twitter.com/andreagrandi">twitter</a></li>
                            <li><a href="https://github.com/andreagrandi">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>
                    Powered by <a href="http://getpelican.com/">Pelican</a> and Python -
                    Source code available on <a href="https://github.com/andreagrandi/andreagrandi.it">GitHub</a>
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
                        <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" />
                    </a>
                </p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2140684-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'andrea-grandi-it';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>