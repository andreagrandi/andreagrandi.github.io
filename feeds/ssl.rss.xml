<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>Andrea Grandi - ssl</title><link>https://www.andreagrandi.it/</link><description></description><lastBuildDate>Sun, 06 Dec 2015 14:15:00 +0000</lastBuildDate><item><title>Getting a free SSL certificate from Letsencrypt and configuring it on Nginx with automatic renewal</title><link>https://www.andreagrandi.it/2015/12/06/getting-a-free-ssl-certificate-from-letsencrypt-and-configuring-it-on-nginx-with-automatic-renewal/</link><description>&lt;p&gt;Finally &lt;strong&gt;&lt;a href="https://letsencrypt.org/"&gt;Letsencrypt&lt;/a&gt;&lt;/strong&gt; went to &lt;strong&gt;public
beta&lt;/strong&gt; and I really couldn't wait to use it on my VPS (where this blog
is hosted). Until few days ago I was using a &lt;strong&gt;free SSL&lt;/strong&gt; certificate
from &lt;a href="https://www.startssl.com/"&gt;StartSSL&lt;/a&gt;. The service is nice and I'm
grateful to them for this important resource they are providing for
free, but it must be said that their renewal procedure isn't one of the
most user friendly.&lt;/p&gt;
&lt;p&gt;For people who don't know the service yet, &lt;strong&gt;Letsencrypt&lt;/strong&gt; not only
gives &lt;strong&gt;free SSL certificates&lt;/strong&gt;, they also provide a command line tool
that people can use to request a new certificate or to renew an existing
one. This means that you don't have to worry anymore if/when your
certificate expires, you can set a crontab command and have the
certificate &lt;strong&gt;automatically renewed&lt;/strong&gt; for you.&lt;/p&gt;
&lt;h2&gt;Client installation&lt;/h2&gt;
&lt;p&gt;To request a SSL certificate you need to install their command line
utility. Unless it has already been packaged for your distribution, for
the moment it's much easier to get it from git as they explain in their
&lt;a href="https://letsencrypt.readthedocs.org/en/latest/using.html#installation"&gt;installation
instructions&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;``` {.lang:sh .decode:true}
git clone https://github.com/letsencrypt/letsencrypt
cd letsencrypt
./letsencrypt-auto&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gh"&gt;Getting the SSL certificate&lt;/span&gt;
&lt;span class="gh"&gt;---------------------------&lt;/span&gt;

There are a few different options available to request a certificate,
but the easiest one is to use the &lt;span class="gs"&gt;**--webroot**&lt;/span&gt; option, specifying the
document root of your website so that the client will be able to put
there a verification (temporary) file that will be served to the remote
service and used as verification method. In my case I only needed this
command:

&lt;span class="s"&gt;``` {.lang:sh .decode:true}&lt;/span&gt;
&lt;span class="s"&gt;./letsencrypt-auto certonly --webroot -w /var/www/andreagrandi.it/ -d www.andreagrandi.it -d andreagrandi.it --email myemail@myprovider.com --renew-by-default --agree-tos&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Please note that I had to specify both www.andreagrandi.it and
andreagrandi.it as domains, otherwise it would have been invalid when
requesting just andreagrandi.it resources.&lt;/p&gt;
&lt;h2&gt;Configuration files and certificates installation&lt;/h2&gt;
&lt;p&gt;The command above will save all the configuration under
&lt;strong&gt;/etc/letsencrypt/&lt;/strong&gt; and all the generated certificates under
&lt;strong&gt;/etc/letsencrypt/live/www.andreagrandi.it/*.pem&lt;/strong&gt; (all the *.pem
files here are symbolic links to the current certificate). If you are
using &lt;strong&gt;Nginx&lt;/strong&gt; the only files you need are &lt;strong&gt;fullchain.pem&lt;/strong&gt; and
&lt;strong&gt;privkey.pem&lt;/strong&gt; and you can set them in your Nginx configuration using
these two parameters:&lt;/p&gt;
&lt;p&gt;``` {.lang:default .decode:true}
ssl_certificate /etc/letsencrypt/live/www.andreagrandi.it/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/www.andreagrandi.it/privkey.pem;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;In&lt;/span&gt; &lt;span class="nv"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;you&lt;/span&gt; &lt;span class="nv"&gt;want&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;have&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="nv"&gt;look&lt;/span&gt; &lt;span class="nv"&gt;at&lt;/span&gt; &lt;span class="nv"&gt;my&lt;/span&gt; &lt;span class="nv"&gt;full&lt;/span&gt; &lt;span class="nv"&gt;Nginx&lt;/span&gt; &lt;span class="nv"&gt;configuration&lt;/span&gt; &lt;span class="nv"&gt;file&lt;/span&gt;, &lt;span class="nv"&gt;as&lt;/span&gt;
&lt;span class="nv"&gt;reference&lt;/span&gt;, &lt;span class="nv"&gt;you&lt;/span&gt; &lt;span class="nv"&gt;can&lt;/span&gt; &lt;span class="nv"&gt;find&lt;/span&gt; &lt;span class="nv"&gt;it&lt;/span&gt;
&lt;span class="nv"&gt;here&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nv"&gt;https&lt;/span&gt;:&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="nv"&gt;gist&lt;/span&gt;.&lt;span class="nv"&gt;github&lt;/span&gt;.&lt;span class="nv"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;andreagrandi&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="nv"&gt;b194c99cd3e77fdb5a8&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;

&lt;span class="nv"&gt;Automatic&lt;/span&gt; &lt;span class="nv"&gt;renewal&lt;/span&gt;
&lt;span class="o"&gt;-----------------&lt;/span&gt;

&lt;span class="nv"&gt;The&lt;/span&gt; &lt;span class="nv"&gt;last&lt;/span&gt; &lt;span class="nv"&gt;thing&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;be&lt;/span&gt; &lt;span class="nv"&gt;configured&lt;/span&gt; &lt;span class="nv"&gt;is&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="nv"&gt;crontab&lt;/span&gt; &lt;span class="nv"&gt;rule&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="k"&gt;call&lt;/span&gt; &lt;span class="nl"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;script&lt;/span&gt;
&lt;span class="nv"&gt;every&lt;/span&gt;... &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="nv"&gt;months&lt;/span&gt;. &lt;span class="nv"&gt;Why&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="nv"&gt;months&lt;/span&gt;? &lt;span class="nv"&gt;Letsencrypt&lt;/span&gt; &lt;span class="nv"&gt;SSL&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="nv"&gt;certificates&lt;/span&gt; &lt;span class="nv"&gt;expire&lt;/span&gt;
&lt;span class="nv"&gt;in&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="nv"&gt;months&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;. &lt;span class="nv"&gt;Usually&lt;/span&gt; &lt;span class="nv"&gt;SSL&lt;/span&gt; &lt;span class="nv"&gt;certificates&lt;/span&gt; &lt;span class="nv"&gt;are&lt;/span&gt; &lt;span class="nv"&gt;valid&lt;/span&gt; &lt;span class="nv"&gt;at&lt;/span&gt; &lt;span class="nv"&gt;least&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;year&lt;/span&gt;,
&lt;span class="nv"&gt;but&lt;/span&gt; &lt;span class="nv"&gt;Letsencrypt&lt;/span&gt; &lt;span class="nv"&gt;decided&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;make&lt;/span&gt; &lt;span class="nv"&gt;it&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="nv"&gt;months&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;incentivate&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt;
&lt;span class="nv"&gt;automation&lt;/span&gt; &lt;span class="nv"&gt;of&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;renewal&lt;/span&gt;. &lt;span class="nv"&gt;I&lt;/span&gt; &lt;span class="nv"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;it&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="nv"&gt;months&lt;/span&gt;, &lt;span class="nv"&gt;so&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;anything&lt;/span&gt; &lt;span class="nv"&gt;goes&lt;/span&gt;
&lt;span class="nv"&gt;wrong&lt;/span&gt; &lt;span class="nv"&gt;I&lt;/span&gt; &lt;span class="nv"&gt;still&lt;/span&gt; &lt;span class="nv"&gt;have&lt;/span&gt; &lt;span class="nv"&gt;plenty&lt;/span&gt; &lt;span class="nv"&gt;of&lt;/span&gt; &lt;span class="nv"&gt;time&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="nv"&gt;it&lt;/span&gt; &lt;span class="nv"&gt;manually&lt;/span&gt;. &lt;span class="nv"&gt;To&lt;/span&gt; &lt;span class="nv"&gt;edit&lt;/span&gt; &lt;span class="nv"&gt;crontab&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt;
&lt;span class="nv"&gt;root&lt;/span&gt; &lt;span class="nv"&gt;user&lt;/span&gt; &lt;span class="nv"&gt;execute&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="nv"&gt;crontab&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;e&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt; &lt;span class="nv"&gt;and&lt;/span&gt; &lt;span class="nv"&gt;add&lt;/span&gt; &lt;span class="nv"&gt;this&lt;/span&gt; &lt;span class="nv"&gt;line&lt;/span&gt;:

``` {.&lt;span class="nv"&gt;lang&lt;/span&gt;:&lt;span class="nv"&gt;default&lt;/span&gt; .&lt;span class="nv"&gt;decode&lt;/span&gt;:&lt;span class="nv"&gt;true&lt;/span&gt;}
&lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;letsencrypt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;letsencrypt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;auto&lt;/span&gt; &lt;span class="nv"&gt;certonly&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nv"&gt;webroot&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;w&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;www&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;andreagrandi&lt;/span&gt;.&lt;span class="nv"&gt;it&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;d&lt;/span&gt; &lt;span class="nv"&gt;www&lt;/span&gt;.&lt;span class="nv"&gt;andreagrandi&lt;/span&gt;.&lt;span class="nv"&gt;it&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;d&lt;/span&gt; &lt;span class="nv"&gt;andreagrandi&lt;/span&gt;.&lt;span class="nv"&gt;it&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nv"&gt;email&lt;/span&gt; &lt;span class="nv"&gt;email&lt;/span&gt;@&lt;span class="nv"&gt;domain&lt;/span&gt;.&lt;span class="nv"&gt;com&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nv"&gt;renew&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;by&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;default&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nv"&gt;agree&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nv"&gt;tos&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nv"&gt;service&lt;/span&gt; &lt;span class="nv"&gt;nginx&lt;/span&gt; &lt;span class="nv"&gt;reload&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Just a final note. You may have noticed that this website presents an
SSL certificate issued by COMODO. That's because I have
&lt;strong&gt;&lt;a href="https://www.cloudflare.com/"&gt;CloudFlare&lt;/a&gt;&lt;/strong&gt; in front of my website and
that's how their SSL strict option works (at least for free plans).&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">admin</dc:creator><pubDate>Sun, 06 Dec 2015 14:15:00 +0000</pubDate><guid isPermaLink="false">tag:www.andreagrandi.it,2015-12-06:/2015/12/06/getting-a-free-ssl-certificate-from-letsencrypt-and-configuring-it-on-nginx-with-automatic-renewal/</guid><category>DevOps, HowTo, Linux</category><category>encryption</category><category>letsencrypt</category><category>security</category><category>ssl</category></item></channel></rss>