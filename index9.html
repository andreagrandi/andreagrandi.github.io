
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link
    href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="https://www.andreagrandi.it/theme/stylesheet/style.min.css">


  <link id="pygments-light-theme" rel="stylesheet" type="text/css"     href="https://www.andreagrandi.it/theme/pygments/monokai.min.css">

  <script src="https://www.andreagrandi.it/theme/tipuesearch/jquery.min.js"></script>
  <script defer src="https://www.andreagrandi.it/theme/tipuesearch/tipuesearch.min.js"></script>
  <script defer src="https://www.andreagrandi.it/theme/tipuesearch/tipuesearch_set.js"></script>
  <script defer src="https://www.andreagrandi.it/tipuesearch_content.js"></script>
  <link rel="stylesheet" href="https://www.andreagrandi.it/theme/tipuesearch/tipuesearch.min.css" />

  <link rel="stylesheet" type="text/css" href="https://www.andreagrandi.it/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://www.andreagrandi.it/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://www.andreagrandi.it/theme/font-awesome/css/solid.css">



  <link href="https://www.andreagrandi.it/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
    title="Andrea Grandi RSS">


<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2140684-3', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#333333">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#333333">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Microsoft EDGE -->
  <meta name="msapplication-TileColor" content="#333333">

  <meta name="author" content="Andrea Grandi" />
  <meta name="description" content="" />
<meta property="og:site_name" content="Andrea Grandi"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="Andrea Grandi"/>
<meta property="og:description" content=""/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://www.andreagrandi.it"/>
<meta property="og:image" content="/images/me_pycon_2019_2_300x300.jpg">

  <title>Andrea Grandi</title>



  <link rel="me" href="https://mastodon.social/@andreagrandi" />
</head>

<body class="light-theme"
>
  <aside>
    <div>
      <a href="https://www.andreagrandi.it">
        <img src="/images/me_pycon_2019_2_300x300.jpg" alt="Andrea Grandi" title="Andrea Grandi">
      </a>

      <h1>
        <a href="https://www.andreagrandi.it">Andrea Grandi</a>
      </h1>

<p>Software Developer</p>
      <form class="navbar-search" action="/search.html" role="search">
        <input type="text" name="q" id="tipue_search_input" placeholder="Search...">
      </form>

      <nav>
        <ul class="list">


          <li>
            <a target="_self"
              href="https://www.andreagrandi.it/about/">
              About
            </a>
          </li>
          <li>
            <a target="_self"
              href="https://www.andreagrandi.it/curriculum/">
              Curriculum
            </a>
          </li>
          <li>
            <a target="_self"
              href="https://www.andreagrandi.it/pgp-key/">
              PGP Key
            </a>
          </li>

        </ul>
      </nav>

      <ul class="social">
        <li>
          <a  class="sc-twitter" href="https://twitter.com/andreagrandi" target="_blank">
            <i class="fab fa-twitter"></i>
          </a>
        </li>
        <li>
          <a  class="sc-github" href="https://github.com/andreagrandi" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        </li>
        <li>
          <a  class="sc-linkedin" href="https://www.linkedin.com/in/andreagrandi/" target="_blank">
            <i class="fab fa-linkedin"></i>
          </a>
        </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="https://www.andreagrandi.it">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>


      <a href="https://www.andreagrandi.it/feeds/all.rss.xml">RSS</a>
    </nav>



<article>
  <header>
    <h2><a href="https://www.andreagrandi.it/2015/12/06/getting-a-free-ssl-certificate-from-letsencrypt-and-configuring-it-on-nginx-with-automatic-renewal/">Getting a free SSL certificate from Letsencrypt and configuring it on Nginx with automatic renewal</a></h2>
    <p>
      Posted on Sun 06 December 2015 in <a href="https://www.andreagrandi.it/category/devops-howto-linux.html">DevOps, HowTo, Linux</a>

          &#8226; Tagged with
              <a href="https://www.andreagrandi.it/tag/encryption.html">encryption</a>,              <a href="https://www.andreagrandi.it/tag/letsencrypt.html">letsencrypt</a>,              <a href="https://www.andreagrandi.it/tag/security.html">security</a>,              <a href="https://www.andreagrandi.it/tag/ssl.html">ssl</a>
    </p>
  </header>
  <div>
      <p>Finally <strong><a href="https://letsencrypt.org/">Letsencrypt</a></strong> went to <strong>public
beta</strong> and I really couldn't wait to use it on my VPS (where this blog
is hosted). Until few days ago I was using a <strong>free SSL</strong> certificate
from <a href="https://www.startssl.com/">StartSSL</a>. The service is nice and I'm
grateful to them for this important resource they are providing for
free, but it must be said that their renewal procedure isn't one of the
most user friendly.</p>
<p>For people who don't know the service yet, <strong>Letsencrypt</strong> not only
gives <strong>free SSL certificates</strong>, they also provide a command line tool
that people can use to request a new certificate or to renew an existing
one. This means that you don't have to worry anymore if/when your
certificate expires, you can set a crontab command and have the
certificate <strong>automatically renewed</strong> for you.</p>
<h2>Client installation</h2>
<p>To request a SSL certificate you need to install their command line
utility. Unless it has already been packaged for your distribution, for
the moment it's much easier to get it from git as they explain in their
<a href="https://letsencrypt.readthedocs.org/en/latest/using.html#installation">installation
instructions</a>:</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/letsencrypt/letsencrypt
<span class="nb">cd</span> letsencrypt
./letsencrypt-auto
</code></pre></div>

<h2>Getting the SSL certificate</h2>
<p>There are a few different options available to request a certificate,
but the easiest one is to use the <strong>--webroot</strong> option, specifying the
document root of your website so that the client will be able to put
there a verification (temporary) file that will be served to the remote
service and used as verification method. In my case I only needed this
command:</p>
<div class="highlight"><pre><span></span><code>./letsencrypt-auto certonly --webroot -w /var/www/andreagrandi.it/ -d www.andreagrandi.it -d andreagrandi.it --email myemail@myprovider.com --renew-by-default --agree-tos
</code></pre></div>

<p>Please note that I had to specify both www.andreagrandi.it and
andreagrandi.it as domains, otherwise it would have been invalid when
requesting just andreagrandi.it resources.</p>
<h2>Configuration files and certificates installation</h2>
<p>The command above will save all the configuration under
<strong>/etc/letsencrypt/</strong> and all the generated certificates under
<strong>/etc/letsencrypt/live/www.andreagrandi.it/*.pem</strong> (all the *.pem
files here are symbolic links to the current certificate). If you are
using <strong>Nginx</strong> the only files you need are <strong>fullchain.pem</strong> and
<strong>privkey.pem</strong> and you can set them in your Nginx configuration using
these two parameters:</p>
<div class="highlight"><pre><span></span><code>ssl_certificate /etc/letsencrypt/live/www.andreagrandi.it/fullchain.pem<span class="p">;</span>
ssl_certificate_key /etc/letsencrypt/live/www.andreagrandi.it/privkey.pem<span class="p">;</span>
</code></pre></div>

<p>In case you want to have a look at my full Nginx configuration file, as
reference, you can find it
here <a href="https://gist.github.com/andreagrandi/8b194c99cd3e77fdb5a8">https://gist.github.com/andreagrandi/8b194c99cd3e77fdb5a8</a></p>
<h2>Automatic renewal</h2>
<p>The last thing to be configured is a crontab rule to call the script
every... 2 months. Why 2 months? Letsencrypt SSL <strong>certificates expire
in 3 months</strong>. Usually SSL certificates are valid at least for 1 year,
but Letsencrypt decided to make it 3 months to incentivate the
automation of the renewal. I set it to 2 months, so if anything goes
wrong I still have plenty of time to do it manually. To edit crontab for
root user execute <strong>crontab -e</strong> and add this line:</p>
<div class="highlight"><pre><span></span><code><span class="m">0</span> <span class="m">3</span> <span class="m">1</span> */2 * /root/letsencrypt/letsencrypt-auto certonly --webroot -w /var/www/andreagrandi.it/ -d www.andreagrandi.it -d andreagrandi.it --email email@domain.com --renew-by-default --agree-tos <span class="o">&amp;&amp;</span> service nginx reload
</code></pre></div>

<p>Just a final note. You may have noticed that this website presents an
SSL certificate issued by COMODO. That's because I have
<strong><a href="https://www.cloudflare.com/">CloudFlare</a></strong> in front of my website and
that's how their SSL strict option works (at least for free plans).</p>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://www.andreagrandi.it/2015/10/11/reversing-a-list-in-python/">Reversing a List in Python</a></h2>
    <p>
      Posted on Sun 11 October 2015 in <a href="https://www.andreagrandi.it/category/development.html">Development</a>

          &#8226; Tagged with
              <a href="https://www.andreagrandi.it/tag/lists.html">lists</a>,              <a href="https://www.andreagrandi.it/tag/python.html">Python</a>,              <a href="https://www.andreagrandi.it/tag/reversed.html">reversed</a>
    </p>
  </header>
  <div>
      <p>Sometimes we need to reverse the order of the elements in a Python list.
While there can be many different ways of implementing this task, I
found three in particular that I appreciate for different reasons. Let's
define first a list of integers that we will reverse later.</p>
<div class="highlight"><pre><span></span><code><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</code></pre></div>

<h3>List slicing</h3>
<p>This method can be a bit obscure at first read, but basically it slices
the whole list proceding in the reverse order:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="nb">input</span><span class="p">]:</span> <span class="nb">print</span> <span class="n">l</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">[</span><span class="n">output</span><span class="p">]:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div>

<h3>Reversed method</h3>
<p>We use the
<strong><a href="https://docs.python.org/2/library/functions.html#reversed">reversed</a></strong> method
that returns an iterable object and a list comprehension to generate the
new list</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="nb">input</span><span class="p">]:</span> <span class="nb">print</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span>
<span class="p">[</span><span class="n">output</span><span class="p">]:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div>

<h3>Swapping values in place</h3>
<p>This last method is more verbose and it basically divides the list in
two parts and swaps the first with sixth, the second with fifth, etc...</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="nb">input</span><span class="p">]:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">i</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="nb">print</span> <span class="n">l</span>

<span class="p">[</span><span class="n">output</span><span class="p">]:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://www.andreagrandi.it/2015/10/11/how-to-configure-encfs-on-osx-10-10-yosemite/">How to configure EncFS on OSX 10.10 (Yosemite)</a></h2>
    <p>
      Posted on Sun 11 October 2015 in <a href="https://www.andreagrandi.it/category/howto-osx-sicurezza.html">HowTo, OSX, Sicurezza</a>

          &#8226; Tagged with
              <a href="https://www.andreagrandi.it/tag/cloud.html">cloud</a>,              <a href="https://www.andreagrandi.it/tag/encfs.html">encfs</a>,              <a href="https://www.andreagrandi.it/tag/encryption.html">encryption</a>,              <a href="https://www.andreagrandi.it/tag/osx.html">OSX</a>,              <a href="https://www.andreagrandi.it/tag/security.html">security</a>
    </p>
  </header>
  <div>
      <p>With <strong>EncFS</strong> it's possible to keep our data in almost any cloud
(Dropbox, OneDrive, etc...), having a good level of privacy and
security. Infact EncFS encrypt and decrypt our data automatically. It's
available for Linux as well and using a commercial solution (that is
currently unsupported) even on Windows.</p>
<h2>Installing EncFS</h2>
<p>EncFS can be installed from <strong>brew</strong>. If you don't have brew package
manager installed on OSX you can install it using this command:</p>
<div class="highlight"><pre><span></span><code>ruby -e <span class="s2">&quot;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>

<p>After brew, you need to install <strong>OSXFuse</strong> from this
website <a href="http://osxfuse.github.io">http://osxfuse.github.io</a></p>
<p>Finally you can install <strong>encfs</strong> using this command:</p>
<div class="highlight"><pre><span></span><code>brew install homebrew/fuse/encfs
</code></pre></div>

<h2>Configuring the encrypted folder</h2>
<p>Now that EncFS is installed, you can either mount an existing EncFS
volume or create a new one. In both cases the command is the same:</p>
<div class="highlight"><pre><span></span><code>encfs ~/Dropbox/Private ~/Private
</code></pre></div>

<p>If you are mounting an existing encrypted volume, you will be prompted
for the password. If you are creating a new encrypted volume you will be
asked some questions about EncFS parameters.</p>
<p><strong>Note:</strong> if it's important for you to keep compatibility with
<strong><a href="https://www.boxcryptor.com/en/classic">BoxCryptor Classic</a></strong> (in case
you want to use the same volume under Windows), please refer to this
other article I
wrote: <a href="https://www.andreagrandi.it/2014/09/12/create-an-encfs-volume-compatible-with-boxcryptor-classic/">https://www.andreagrandi.it/2014/09/12/create-an-encfs-volume-compatible-with-boxcryptor-classic/</a></p>
<h2>Mount the encrypted volume on startup</h2>
<p>First of all you need to save the volume's password inside the OSX
keychain. Open the app <strong>Keychain Access</strong> and create a new entry with
name <strong>encfs</strong> and account value <strong>encfs</strong>, then write your <strong>password</strong>
and click <strong>Add</strong>:</p>
<p><a href="https://www.andreagrandi.it/images/2015/10/encfs_keychain_access.png"><img alt="encfs_keychain_access" src="https://www.andreagrandi.it/images/2015/10/encfs_keychain_access.png" width="60%"></a></p>
<p>Once the password is saved, <strong>open a text editor</strong> and paste this script
and save it as <strong>encfs_mount.sh</strong> inside your <strong>\$HOME</strong> folder:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># Secure EncFS Dropbox mounter by Daniel Widerin &lt;daniel@widerin.net&gt;</span>

<span class="nv">SOURCE</span><span class="o">=</span>~/Dropbox/Private
<span class="nv">TARGET</span><span class="o">=</span>~/Private
<span class="nv">VOLUME_TITLE</span><span class="o">=</span>Private
<span class="nv">KEYCHAIN_PASSWORD</span><span class="o">=</span><span class="s1">&#39;encfs&#39;</span>
<span class="nv">ENCFS</span><span class="o">=</span>/usr/local/bin/encfs

mount <span class="p">|</span> grep <span class="nv">$TARGET</span> &gt;/dev/null
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$?</span><span class="s2">&quot;</span> -eq <span class="s2">&quot;0&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> /usr/sbin/diskutil unmount <span class="nv">$TARGET</span>

<span class="k">if</span> <span class="o">[</span> ! -d <span class="nv">$TARGET</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="nb">echo</span> <span class="s2">&quot;Create new mountpoint </span><span class="nv">$TARGET</span><span class="s2">&quot;</span>
mkdir <span class="nv">$TARGET</span>
chmod <span class="m">0700</span> <span class="nv">$TARGET</span>
<span class="k">fi</span>

<span class="nv">$ENCFS</span> <span class="nv">$SOURCE</span> <span class="nv">$TARGET</span> --extpass<span class="o">=</span><span class="s2">&quot;security 2&gt;&amp;1 &gt;/dev/null find-generic-password -gl &#39;</span><span class="nv">$KEYCHAIN_PASSWORD</span><span class="s2">&#39; |grep password|cut -d \\\&quot; -f 2&quot;</span> -ovolname<span class="o">=</span><span class="nv">$VOLUME_TITLE</span>
</code></pre></div>

<p>Make it <strong>executable</strong>:</p>
<div class="highlight"><pre><span></span><code>chmod +x ~/encfs_mount.sh
</code></pre></div>

<p>Open <strong>AppleScript</strong> editor and paste this text inside and save as an
app in the \$HOME folder:</p>
<p><a href="https://www.andreagrandi.it/images/2015/10/Screenshot-2015-10-11-19.27.14.png"><img alt="apple script" src="https://www.andreagrandi.it/images/2015/10/Screenshot-2015-10-11-19.27.14.png" width="60%"></a></p>
<div class="highlight"><pre><span></span><code><span class="k">do</span> shell script <span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/encfs_mount.sh&quot;</span>
</code></pre></div>

<p>Finally, open "<strong>System Preferences</strong>" -&gt; "<strong>Users &amp; Groups</strong>" and
add the previously saved application.</p>
<p><a href="https://www.andreagrandi.it/images/2015/10/Screenshot-2015-10-11-19.27.44.png"><img alt="system preferences" src="https://www.andreagrandi.it/images/2015/10/Screenshot-2015-10-11-19.27.44.png" width="60%"></a></p>
<h2>Final notes</h2>
<p>At this point encfs is configured to be mounted at startup and to save
the encrypted files inside Dropbox. Please note: <strong>do not save anything
directly on <code>~/Dropbox/Private</code></strong>, only read and save your files from
<code>~/Private</code></p>
<h2>References</h2>
<ul>
<li><a href="https://www.maketecheasier.com/install-encfs-mac/">https://www.maketecheasier.com/install-encfs-mac/</a></li>
<li><a href="http://ninjatips.com/encrypt-dropbox-using-encfs/">http://ninjatips.com/encrypt-dropbox-using-encfs/</a></li>
</ul>
  </div>
  <hr />
</article>
<article>
  <header>
    <h2><a href="https://www.andreagrandi.it/2015/08/31/understanding-python-decorators-optimizing-a-recursive-fibonacci-implementation/">Understanding Python decorators optimizing a recursive Fibonacci implementation</a></h2>
    <p>
      Posted on Mon 31 August 2015 in <a href="https://www.andreagrandi.it/category/programmazione-python.html">Programmazione, Python</a>

          &#8226; Tagged with
              <a href="https://www.andreagrandi.it/tag/decorators.html">decorators</a>,              <a href="https://www.andreagrandi.it/tag/fibonacci.html">fibonacci</a>,              <a href="https://www.andreagrandi.it/tag/memoization.html">memoization</a>,              <a href="https://www.andreagrandi.it/tag/memoize.html">memoize</a>,              <a href="https://www.andreagrandi.it/tag/optimization.html">optimization</a>,              <a href="https://www.andreagrandi.it/tag/python.html">Python</a>
    </p>
  </header>
  <div>
      <p>A <strong>decorator</strong> is a Python function that takes a <em>function object</em> as
an argument and returns a function as a <em>value</em>. Here is an example of
decorator definition:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="c1"># make a new function</span>
    <span class="k">def</span> <span class="nf">new_function</span><span class="p">():</span>
        <span class="c1"># some code</span>

    <span class="k">return</span> <span class="n">new_function</span>
</code></pre></div>

<p>To apply a decorator to an existing function, you just need to put
<strong>@<em>decorator_name</em></strong> in the line before its definition, like this
example:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@foo</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="nb">print</span> <span class="s1">&#39;Hello World&#39;</span>
</code></pre></div>

<p>This decorator doesn't do anything, so let's think about a more concrete
problem we could solve using decorators.</p>
<h2>Fibonacci sequence</h2>
<p>By definition, the first two numbers in the
<strong><a href="https://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci</a></strong> sequence
are either 1 and 1 or 0 and 1. All the other numbers are the sum of the
previous two numbers of the sequence. Example:</p>
<ol>
<li>0, 1: the third number is 1</li>
<li>0, 1, 1: the fourth number is 2</li>
<li>0, 1, 1, 2: the fifth number is 3</li>
<li>0, 1, 1, 2, 3: the sixth number is 5</li>
<li>etc...</li>
</ol>
<p>If we wanted to give a <strong>math definition</strong> of the sequence, we could
describe it in this way:</p>
<ul>
<li><strong>F(0): 0</strong></li>
<li><strong>F(1): 1</strong></li>
<li><strong>F(n): F(n-1) + F(n-2)</strong></li>
</ul>
<p>In <strong>Python</strong> we could have a <strong>recursive function</strong> like the following
one:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>

<p>What's the problem with this implementation? The code works as expected,
but it's very <strong>inefficient</strong>. The next picture will explain what
happens when we will try, for example, to calculate the 5th number of
the sequence:</p>
<p><a href="https://www.andreagrandi.it/images/2015/08/fibo.png"><img alt="fibo" src="https://www.andreagrandi.it/images/2015/08/fibo.png" width="60%"></a></p>
<p>Fib(5) is Fib(4) + Fib(3), but Fib(4) itself is Fib(3) + Fib(2), and...
the picture just tell us that we have calculated Fib(3) 2 times, Fib(2)
3 times, Fib(1) 5 times! Why are we repeating the same operation every
time if we already calculated the result?</p>
<h2>Memoization</h2>
<blockquote>
<p>In computing, <strong>memoization</strong> is an optimization technique used
primarily to speed up computer programs by storing the results of
expensive function calls and returning the cached result when the same
inputs occur again.</p>
</blockquote>
<p>We need to store values of the sequence we have already calculated and
get them later when we need them. Let's implement a simple memoization
decorator:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">memoize</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">args</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">args</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">decorated_function</span>
</code></pre></div>

<p>The decorator defines a dict at the beginning that is used as a cache.
When we want to find the n number of the sequence, it first checks if
the value was already calculated and that value is returned instead of
being calculated again. If the value is not found, then the original
function is being called and then the value is store in the cache, then
returned to the caller.</p>
<h2>Using the memoize decorator</h2>
<p>How much this decorator can speed up our fib method? Let's try to
benchmark the execution using Python
<strong><a href="https://docs.python.org/2/library/timeit.html">timeit</a></strong> module.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># First example, not using the memoize decorator</span>

<span class="kn">import</span> <span class="nn">timeit</span>

<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s2">&quot;fib(35)&quot;</span><span class="p">,</span> <span class="s2">&quot;from __main__ import fib&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">t1</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<p>The required time to calculate the 35th number of the Fibonacci sequence
on my laptop is: <strong>4.73480010033</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Second example, using the memoize decorator</span>

<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">from</span> <span class="nn">memoize</span> <span class="kn">import</span> <span class="n">memoize</span>  <span class="c1"># For convenience I put my decorator</span>
                            <span class="c1"># in a module named memoize.py</span>

<span class="nd">@memoize</span>
<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="s2">&quot;fib(35)&quot;</span><span class="p">,</span> <span class="s2">&quot;from __main__ import fib&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">t1</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<p>The required time to calculate the 35th number of the Fibonacci sequence
on my laptop is: <strong>0.000133037567139</strong></p>
<p>Quite faster, don't you think? I will let you try how long does it take
to calculate the 60th number of the sequence with and without using the
decorator. <strong>Hint:</strong> grab a cup of coffee before beginning!</p>
  </div>
</article>

  <div class="pagination">
    <a class="btn float-left" href="https://www.andreagrandi.it/index10.html">
      <i class="fa fa-angle-left"></i> Older Posts
    </a>
    <a class="btn float-right" href="https://www.andreagrandi.it/index8.html">
      Newer Posts <i class="fa fa-angle-right"></i>
    </a>
  </div>



    <footer>
<p>
  &copy; 2022  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>
  Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme - source code available on <a href="https://github.com/andreagrandi/andreagrandi.it" target="_blank">GitHub</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="images/by-sa.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Andrea Grandi ",
  "url" : "https://www.andreagrandi.it",
  "image": "/images/me_pycon_2019_2_300x300.jpg",
  "description": ""
}
</script>

  <script>
    $(document).ready(function () {
      $('#tipue_search_input').tipuesearch();
    });
  </script>

</body>

</html>