
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="robots"/>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&amp;family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&amp;display=swap" rel="stylesheet"/>
<link href="https://www.andreagrandi.it/theme/stylesheet/style.min.css" rel="stylesheet" type="text/css"/>
<link href="https://www.andreagrandi.it/theme/pygments/monokai.min.css" id="pygments-light-theme" rel="stylesheet" type="text/css"/>
<script src="https://www.andreagrandi.it/theme/tipuesearch/jquery.min.js"></script>
<script defer="" src="https://www.andreagrandi.it/theme/tipuesearch/tipuesearch.min.js"></script>
<script defer="" src="https://www.andreagrandi.it/theme/tipuesearch/tipuesearch_set.js"></script>
<script defer="" src="https://www.andreagrandi.it/tipuesearch_content.js"></script>
<link href="https://www.andreagrandi.it/theme/tipuesearch/tipuesearch.min.css" rel="stylesheet">
<link href="https://www.andreagrandi.it/theme/font-awesome/css/fontawesome.css" rel="stylesheet" type="text/css"/>
<link href="https://www.andreagrandi.it/theme/font-awesome/css/brands.css" rel="stylesheet" type="text/css"/>
<link href="https://www.andreagrandi.it/theme/font-awesome/css/solid.css" rel="stylesheet" type="text/css"/>
<link href="https://www.andreagrandi.it/feeds/all.rss.xml" rel="alternate" title="Andrea Grandi RSS" type="application/rss+xml"/>
<!-- Chrome, Firefox OS and Opera -->
<meta content="#333333" name="theme-color"/>
<!-- Windows Phone -->
<meta content="#333333" name="msapplication-navbutton-color"/>
<!-- iOS Safari -->
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<!-- Microsoft EDGE -->
<meta content="#333333" name="msapplication-TileColor"/>
<meta content="Andrea Grandi" name="author">
<meta content="In the previous part of the tutorial we implemented details management, relations between models, nested APIs and a different level of permissions. Our API is basically complete but it is working properly? Is the source code free of bugs? Would you feel confident to refactor the code without breaking something? The answer to all our question is probably no. I can't be sure if the code behaves properly nor I would feel confident refactoring anything without having some tests coverage. As I mentioned previously, we should have written tests since the beginning, but I really didn't want to mix too many concepts together and I wanted to let the user concentrate on the Rest Framework instead. Test structure and configuration Before beginning the fourth part of this tutorial, make sure you have grabbed the latest source code from https://github.com/andreagrandi/drf-tutorial and you have checked out the previous git tag: git checkout tutorial-1.14 Django has an integrated test runner but my personal choice is to use pytest, so as first thing let's install the needed libraries: pip install pytest pytest-django As long as we respect a minimum of conventions (test files must start with test_ prefix), tests can be placed anywhere in the code. My advice is to put them all together in a separate folder and divide them according to app names. In our case we are going to create a folder named &quot;tests&quot; at the same level of manage.py file. Inside this folder we need to create a __init__.py file and another folder called catalog with an additional __init__.py inside. Now, still at the same level of manage.py create a file called pytest.ini with this content: [pytest] DJANGO_SETTINGS_MODULE=drftutorial.settings Are you feeling confused? No problem. You can checkout the source code containing these changes. git checkout tutorial-1.15 You can check if you have done everything correctly going inside the drftutorial folder (the one containing manage.py) and launching pytest. If you see something like this, you did your changes correctly: (drf-tutorial) ➜ drftutorial git:(master) pytest ============================================================================================================================= test session starts ============================================================================================================================== platform darwin -- Python 2.7.13, pytest-3.0.6, py-1.4.32, pluggy-0.4.0 Django settings: drftutorial.settings (from ini file) rootdir: /Users/andrea/Projects/drf-tutorial/drftutorial, inifile: pytest.ini plugins: django-3.1.2 collected 0 items ========================================================================================================================= no tests ran in 0.01 seconds ========================================================================================================================= (drf-tutorial) ➜ drftutorial git:(master) Writing the first test To begin with, I will show you how to write a simple test that will verify if the API can return the products list. If you remember we implemented this API in the first part of the tutorial. First of all create a file called test_views.py under the folder drftutorial/tests/catalog/ and add this code: import pytest from django.urls import reverse from rest_framework import status from rest_framework.test import APITestCase class TestProductList(APITestCase): @pytest.mark.django_db def test_can_get_product_list(self): url = reverse('product-list') response = self.client.get(url) self.assertEqual(response.status_code, status.HTTP_200_OK) self.assertEqual(len(response.json()), 8) before being able to run this test we need to change a little thing in the catalog/urls.py file, something we should have done since the beginning. Please change the first url in this way, adding the name parameter: urlpatterns = [ url(r'^products/$', views.ProductList.as_view(), name='product-list'), ... at this point we are able to run our test suite again and verify the test is passing: (drf-tutorial) ➜ drftutorial git:(test-productlist) ✗ pytest -v ============================================================================================================================= test session starts ============================================================================================================================== platform darwin -- Python 2.7.13, pytest-3.0.6, py-1.4.32, pluggy-0.4.0 -- /Users/andrea/.virtualenvs/drf-tutorial/bin/python2.7 cachedir: .cache Django settings: drftutorial.settings (from ini file) rootdir: /Users/andrea/Projects/drf-tutorial/drftutorial, inifile: pytest.ini plugins: django-3.1.2 collected 1 items tests/catalog/test_views.py::TestProductList::test_can_get_product_list PASSED =========================================================================================================================== 1 passed in 0.98 seconds =========================================================================================================================== To checkout the source code at this point: git checkout tutorial-1.16 Explaining the test code When we implement a test, the first thing to do is to create a test_* file and import the minimum necessary to write a test class and method. Each test class must inherit from APITestCase and have a name that start with Test, like TestProductList. Since we use pytest, we need to mark our method with @pytest.mark.django_db decorator, to tell the test suite our code will explicitly access the database. We are going to use the client object that is integrated in APITestCase to perform the request. Before doing that we first get the local url using Django's reverse function. At this point we do the call using the client: response = self.client.get(url) and then we assert a couple of things that we expect to be true: self.assertEqual(response.status_code, status.HTTP_200_OK) self.assertEqual(len(response.json()), 8) We check that our API returns the 200 status code and that in the returned JSON there are 8 elements. It's normally a good practice to create test data inside the tests, but in our case we previously created a data migration that creates test data. Migrations are run every time we run tests so when we call our API, the data will be already there. Wrapping up I've written a few tests for all the views we have implemented until now and they are available if you checkout this version of the code: git checkout tutorial-1.17 I've only tested the views but it would be nice to test even the permission class, for example. Please remember to write your tests first, if possible: implementing the code will be much more natural once the tests are already in place." name="description">
<meta content="API, Django, framework, Python, rest, tutorial" name="keywords"/>
<meta content="Andrea Grandi" property="og:site_name">
<meta content="Creating a production ready API with Python and Django Rest Framework – part 4" property="og:title">
<meta content="In the previous part of the tutorial we implemented details management, relations between models, nested APIs and a different level of permissions. Our API is basically complete but it is working properly? Is the source code free of bugs? Would you feel confident to refactor the code without breaking something? The answer to all our question is probably no. I can't be sure if the code behaves properly nor I would feel confident refactoring anything without having some tests coverage. As I mentioned previously, we should have written tests since the beginning, but I really didn't want to mix too many concepts together and I wanted to let the user concentrate on the Rest Framework instead. Test structure and configuration Before beginning the fourth part of this tutorial, make sure you have grabbed the latest source code from https://github.com/andreagrandi/drf-tutorial and you have checked out the previous git tag: git checkout tutorial-1.14 Django has an integrated test runner but my personal choice is to use pytest, so as first thing let's install the needed libraries: pip install pytest pytest-django As long as we respect a minimum of conventions (test files must start with test_ prefix), tests can be placed anywhere in the code. My advice is to put them all together in a separate folder and divide them according to app names. In our case we are going to create a folder named &quot;tests&quot; at the same level of manage.py file. Inside this folder we need to create a __init__.py file and another folder called catalog with an additional __init__.py inside. Now, still at the same level of manage.py create a file called pytest.ini with this content: [pytest] DJANGO_SETTINGS_MODULE=drftutorial.settings Are you feeling confused? No problem. You can checkout the source code containing these changes. git checkout tutorial-1.15 You can check if you have done everything correctly going inside the drftutorial folder (the one containing manage.py) and launching pytest. If you see something like this, you did your changes correctly: (drf-tutorial) ➜ drftutorial git:(master) pytest ============================================================================================================================= test session starts ============================================================================================================================== platform darwin -- Python 2.7.13, pytest-3.0.6, py-1.4.32, pluggy-0.4.0 Django settings: drftutorial.settings (from ini file) rootdir: /Users/andrea/Projects/drf-tutorial/drftutorial, inifile: pytest.ini plugins: django-3.1.2 collected 0 items ========================================================================================================================= no tests ran in 0.01 seconds ========================================================================================================================= (drf-tutorial) ➜ drftutorial git:(master) Writing the first test To begin with, I will show you how to write a simple test that will verify if the API can return the products list. If you remember we implemented this API in the first part of the tutorial. First of all create a file called test_views.py under the folder drftutorial/tests/catalog/ and add this code: import pytest from django.urls import reverse from rest_framework import status from rest_framework.test import APITestCase class TestProductList(APITestCase): @pytest.mark.django_db def test_can_get_product_list(self): url = reverse('product-list') response = self.client.get(url) self.assertEqual(response.status_code, status.HTTP_200_OK) self.assertEqual(len(response.json()), 8) before being able to run this test we need to change a little thing in the catalog/urls.py file, something we should have done since the beginning. Please change the first url in this way, adding the name parameter: urlpatterns = [ url(r'^products/$', views.ProductList.as_view(), name='product-list'), ... at this point we are able to run our test suite again and verify the test is passing: (drf-tutorial) ➜ drftutorial git:(test-productlist) ✗ pytest -v ============================================================================================================================= test session starts ============================================================================================================================== platform darwin -- Python 2.7.13, pytest-3.0.6, py-1.4.32, pluggy-0.4.0 -- /Users/andrea/.virtualenvs/drf-tutorial/bin/python2.7 cachedir: .cache Django settings: drftutorial.settings (from ini file) rootdir: /Users/andrea/Projects/drf-tutorial/drftutorial, inifile: pytest.ini plugins: django-3.1.2 collected 1 items tests/catalog/test_views.py::TestProductList::test_can_get_product_list PASSED =========================================================================================================================== 1 passed in 0.98 seconds =========================================================================================================================== To checkout the source code at this point: git checkout tutorial-1.16 Explaining the test code When we implement a test, the first thing to do is to create a test_* file and import the minimum necessary to write a test class and method. Each test class must inherit from APITestCase and have a name that start with Test, like TestProductList. Since we use pytest, we need to mark our method with @pytest.mark.django_db decorator, to tell the test suite our code will explicitly access the database. We are going to use the client object that is integrated in APITestCase to perform the request. Before doing that we first get the local url using Django's reverse function. At this point we do the call using the client: response = self.client.get(url) and then we assert a couple of things that we expect to be true: self.assertEqual(response.status_code, status.HTTP_200_OK) self.assertEqual(len(response.json()), 8) We check that our API returns the 200 status code and that in the returned JSON there are 8 elements. It's normally a good practice to create test data inside the tests, but in our case we previously created a data migration that creates test data. Migrations are run every time we run tests so when we call our API, the data will be already there. Wrapping up I've written a few tests for all the views we have implemented until now and they are available if you checkout this version of the code: git checkout tutorial-1.17 I've only tested the views but it would be nice to test even the permission class, for example. Please remember to write your tests first, if possible: implementing the code will be much more natural once the tests are already in place." property="og:description">
<meta content="en_US" property="og:locale">
<meta content="https://www.andreagrandi.it/2017/08/17/creating-a-production-ready-api-with-python-and-django-rest-framework-part-4/" property="og:url"/>
<meta content="article" property="og:type"/>
<meta content="2017-08-17 07:00:00+02:00" property="article:published_time"/>
<meta content="" property="article:modified_time"/>
<meta content="https://www.andreagrandi.it/author/andrea-grandi.html" property="article:author"/>
<meta content="Development" property="article:section">
<meta content="API" property="article:tag"/>
<meta content="Django" property="article:tag"/>
<meta content="framework" property="article:tag"/>
<meta content="Python" property="article:tag"/>
<meta content="rest" property="article:tag"/>
<meta content="tutorial" property="article:tag"/>
<meta content="/images/me_pycon_2019_2_300x300.jpg" property="og:image"/>
<title>Andrea Grandi – Creating a production ready API with Python and Django Rest Framework – part 4</title>
<link href="https://www.andreagrandi.it/2017/08/17/creating-a-production-ready-api-with-python-and-django-rest-framework-part-4/" rel="canonical">
<link href="https://mastodon.social/@andreagrandi" rel="me">
</link></link></meta></meta></meta></meta></meta></meta></meta></link><link href="https://www.andreagrandi.it/2017/08/17/creating-a-production-ready-api-with-python-and-django-rest-framework-part-4/" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Andrea Grandi", "item": "https://www.andreagrandi.it"}, {"@type": "ListItem", "position": 2, "name": "2017", "item": "https://www.andreagrandi.it/2017"}, {"@type": "ListItem", "position": 3, "name": "08", "item": "https://www.andreagrandi.it/2017/08"}, {"@type": "ListItem", "position": 4, "name": "17", "item": "https://www.andreagrandi.it/2017/08/17"}, {"@type": "ListItem", "position": 5, "name": "Creating a production ready api with python and django rest framework part 4", "item": "https://www.andreagrandi.it/2017/08/17/creating-a-production-ready-api-with-python-and-django-rest-framework-part-4"}, {"@type": "ListItem", "position": 6, "name": "Index", "item": "https://www.andreagrandi.it/2017/08/17/creating-a-production-ready-api-with-python-and-django-rest-framework-part-4/index.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Andrea Grandi"}, "publisher": {"@type": "Organization", "name": "Andrea Grandi"}, "headline": "Creating a production ready API with Python and Django Rest Framework – part 4", "about": "Development", "datePublished": "2017-08-17 07:00"}</script></head>
<body class="light-theme">
<aside>
<div>
<a href="https://www.andreagrandi.it">
<img alt="Andrea Grandi" src="/images/me_pycon_2019_2_300x300.jpg" title="Andrea Grandi"/>
</a>
<h1>
<a href="https://www.andreagrandi.it">Andrea Grandi</a>
</h1>
<p>Software Developer</p>
<form action="/search.html" class="navbar-search" role="search">
<input id="tipue_search_input" name="q" placeholder="Search..." type="text"/>
</form>
<nav>
<ul class="list">
<li>
<a href="https://www.andreagrandi.it/about/" target="_self">
              About
            </a>
</li>
<li>
<a href="https://www.andreagrandi.it/curriculum/" target="_self">
              Curriculum
            </a>
</li>
<li>
<a href="https://www.andreagrandi.it/pgp-key/" target="_self">
              PGP Key
            </a>
</li>
</ul>
</nav>
<ul class="social">
<li>
<a class="sc-mastodon" href="https://mastodon.social/@andreagrandi" rel="me" target="_blank">
<i class="fab fa-mastodon"></i>
</a>
</li>
<li>
<a class="sc-github" href="https://github.com/andreagrandi" target="_blank">
<i class="fab fa-github"></i>
</a>
</li>
<li>
<a class="sc-linkedin" href="https://www.linkedin.com/in/andreagrandi/" target="_blank">
<i class="fab fa-linkedin"></i>
</a>
</li>
</ul>
</div>
<a href="https://tree-nation.com/profile/impact/andreagrandi#co2" style="position:relative;cursor:pointer;display:block;z-index:999;" target="_blank">
<img src="https://tree-nation.com/images/tracking/label-co2-website-white-en.png" style="width:157px;height:auto;"/>
</a>
<script src="https://tree-nation.com/js/track.js"></script>
<script>treenation_track("63a8beb06e6e6");</script>
</aside>
<main>
<nav>
<a href="https://www.andreagrandi.it">Home</a>
<a href="/archives.html">Archives</a>
<a href="/categories.html">Categories</a>
<a href="/tags.html">Tags</a>
<a href="https://www.andreagrandi.it/feeds/all.rss.xml">RSS</a>
</nav>
<article class="single">
<header>
<h1 id="creating-a-production-ready-api-with-python-and-django-rest-framework-part-4">Creating a production ready API with Python and Django Rest Framework – part 4</h1>
<p>
      Posted on Thu 17 August 2017 in <a href="https://www.andreagrandi.it/category/development.html">Development</a>
</p>
</header>
<div>
<p>In the <a href="https://www.andreagrandi.it/2017/03/12/creating-a-production-ready-api-with-python-and-django-rest-framework-part-3/">previous
part</a>
of the tutorial we implemented <strong>details</strong> management, <strong>relations</strong>
between models, <strong>nested APIs</strong> and a different level of permissions.
Our API is basically complete but it is working properly? Is the source
code free of bugs? Would you feel confident to refactor the code without
breaking something? The answer to all our question is probably no. <strong>I
can't be sure if the code behaves properly nor I would feel confident
refactoring anything without having some tests coverage</strong>.</p>
<p>As I mentioned previously, we should have written tests since the
beginning, but I really didn't want to mix too many concepts together
and I wanted to let the user concentrate on the Rest Framework instead.</p>
<h3>Test structure and configuration</h3>
<p>Before beginning the fourth part of this tutorial, make sure you have
grabbed the latest source code
from <a href="https://github.com/andreagrandi/drf-tutorial">https://github.com/andreagrandi/drf-tutorial</a> and you have checked
out the previous git tag:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>checkout<span class="w"> </span>tutorial-1.14
</code></pre></div>
<p>Django has an integrated test runner but my personal choice is to use
<a href="https://doc.pytest.org/en/latest/"><strong>pytest</strong></a>, so as first thing let's
install the needed libraries:</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>pytest<span class="w"> </span>pytest-django
</code></pre></div>
<p>As long as we respect a minimum of conventions (test files must start
with <strong>test_</strong> prefix), tests can be placed anywhere in the code. My
advice is to put them all together in a separate folder and divide them
according to app names. In our case we are going to create a folder
named "<strong>tests</strong>" at the same level of <strong>manage.py</strong> file. Inside this
folder we need to create a <strong>__init__.py</strong> file and another folder
called <strong>catalog</strong> with an additional <strong>__init__.py</strong> inside. Now,
still at the same level of <strong>manage.py</strong> create a file called
<strong>pytest.ini</strong> with this content:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">pytest</span><span class="p">]</span>
<span class="n">DJANGO_SETTINGS_MODULE</span><span class="o">=</span><span class="n">drftutorial</span><span class="o">.</span><span class="n">settings</span>
</code></pre></div>
<p>Are you feeling confused? No problem. You can checkout the source code
containing these changes.</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>checkout<span class="w"> </span>tutorial-1.15
</code></pre></div>
<p>You can check if you have done everything correctly going inside the
drftutorial folder (the one containing <strong>manage.py</strong>) and launching
<strong>pytest</strong>. If you see something like this, you did your changes
correctly:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>drf-tutorial<span class="o">)</span><span class="w"> </span>➜<span class="w">  </span>drftutorial<span class="w"> </span>git:<span class="o">(</span>master<span class="o">)</span><span class="w"> </span><span class="nv">pytest</span>
<span class="o">=============================================================================================================================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==============================================================================================================================</span>
platform<span class="w"> </span>darwin<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">2</span>.7.13,<span class="w"> </span>pytest-3.0.6,<span class="w"> </span>py-1.4.32,<span class="w"> </span>pluggy-0.4.0
Django<span class="w"> </span>settings:<span class="w"> </span>drftutorial.settings<span class="w"> </span><span class="o">(</span>from<span class="w"> </span>ini<span class="w"> </span>file<span class="o">)</span>
rootdir:<span class="w"> </span>/Users/andrea/Projects/drf-tutorial/drftutorial,<span class="w"> </span>inifile:<span class="w"> </span>pytest.ini
plugins:<span class="w"> </span>django-3.1.2
collected<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nv">items</span>

<span class="o">=========================================================================================================================</span><span class="w"> </span>no<span class="w"> </span>tests<span class="w"> </span>ran<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.01<span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="o">=========================================================================================================================</span>
<span class="o">(</span>drf-tutorial<span class="o">)</span><span class="w"> </span>➜<span class="w">  </span>drftutorial<span class="w"> </span>git:<span class="o">(</span>master<span class="o">)</span>
</code></pre></div>
<h3>Writing the first test</h3>
<p>To begin with, I will show you how to write a simple test that will
verify if the API can return the products list. If you remember we
implemented this API in the first part of the tutorial. First of all
create a file called <strong>test_views.py</strong> under the folder
<strong>drftutorial/tests/catalog/</strong> and add this code:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">status</span>
<span class="kn">from</span> <span class="nn">rest_framework.test</span> <span class="kn">import</span> <span class="n">APITestCase</span>


<span class="k">class</span> <span class="nc">TestProductList</span><span class="p">(</span><span class="n">APITestCase</span><span class="p">):</span>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">django_db</span>
    <span class="k">def</span> <span class="nf">test_can_get_product_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">'product-list'</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()),</span> <span class="mi">8</span><span class="p">)</span>
</code></pre></div>
<p>before being able to run this test we need to change a little thing in
the <strong>catalog/urls.py</strong> file, something we should have done since the
beginning. Please change the first url in this way, adding the <strong>name</strong>
parameter:</p>
<div class="highlight"><pre><span></span><code><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">'^products/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ProductList</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'product-list'</span><span class="p">),</span>
    <span class="o">...</span>
</code></pre></div>
<p>at this point we are able to run our test suite again and verify the
test is passing:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>drf-tutorial<span class="o">)</span><span class="w"> </span>➜<span class="w">  </span>drftutorial<span class="w"> </span>git:<span class="o">(</span>test-productlist<span class="o">)</span><span class="w"> </span>✗<span class="w"> </span>pytest<span class="w"> </span>-v
<span class="o">=============================================================================================================================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==============================================================================================================================</span>
platform<span class="w"> </span>darwin<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">2</span>.7.13,<span class="w"> </span>pytest-3.0.6,<span class="w"> </span>py-1.4.32,<span class="w"> </span>pluggy-0.4.0<span class="w"> </span>--<span class="w"> </span>/Users/andrea/.virtualenvs/drf-tutorial/bin/python2.7
cachedir:<span class="w"> </span>.cache
Django<span class="w"> </span>settings:<span class="w"> </span>drftutorial.settings<span class="w"> </span><span class="o">(</span>from<span class="w"> </span>ini<span class="w"> </span>file<span class="o">)</span>
rootdir:<span class="w"> </span>/Users/andrea/Projects/drf-tutorial/drftutorial,<span class="w"> </span>inifile:<span class="w"> </span>pytest.ini
plugins:<span class="w"> </span>django-3.1.2
collected<span class="w"> </span><span class="m">1</span><span class="w"> </span>items

tests/catalog/test_views.py::TestProductList::test_can_get_product_list<span class="w"> </span><span class="nv">PASSED</span>

<span class="o">===========================================================================================================================</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.98<span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="o">===========================================================================================================================</span>
</code></pre></div>
<p>To checkout the source code at this point:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>checkout<span class="w"> </span>tutorial-1.16
</code></pre></div>
<h3>Explaining the test code</h3>
<p>When we implement a test, the first thing to do is to create a
<strong>test_*</strong> file and import the minimum necessary to write a test class
and method. Each test class must inherit from <strong>APITestCase</strong> and have a
name that start with <strong>Test</strong>, like <strong>TestProductList</strong>. Since we use
<a href="https://doc.pytest.org/en/latest/">pytest</a>, we need to mark our method
with <strong>@pytest.mark.django_db decorator</strong>, to tell the test suite our
code will explicitly access the database. We are going to use the <strong>client</strong> object
that is integrated in APITestCase to perform the request. Before doing that we
first get the local <strong>url</strong> using Django's <strong>reverse</strong> function. At this point
we do the call using the client:</p>
<div class="highlight"><pre><span></span><code><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre></div>
<p>and then we assert a couple of things that we expect to be true:</p>
<div class="highlight"><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()),</span> <span class="mi">8</span><span class="p">)</span>
</code></pre></div>
<p>We check that our API returns the <strong>200</strong> status code and that in the returned
JSON there are 8 elements.</p>
<p>It's normally a good practice to create test data inside the tests, but in our case
we previously created a data migration that creates test data. Migrations are
run every time we run tests so when we call our API, the data will be already there.</p>
<h3>Wrapping up</h3>
<p>I've written a <a href="https://github.com/andreagrandi/drf-tutorial/blob/master/drftutorial/tests/catalog/test_views.py">few tests</a> 
for all the views we have implemented until now and they are available
if you checkout this version of the code:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>checkout<span class="w"> </span>tutorial-1.17
</code></pre></div>
<p>I've only tested the views but it would be nice to test even the permission class, for example.
Please remember to write your tests first, if possible: implementing the code will be much more natural
once the tests are already in place.</p>
</div>
<div class="tag-cloud">
<p>
<a href="https://www.andreagrandi.it/tag/api.html">API</a>
<a href="https://www.andreagrandi.it/tag/django.html">Django</a>
<a href="https://www.andreagrandi.it/tag/framework.html">framework</a>
<a href="https://www.andreagrandi.it/tag/python.html">Python</a>
<a href="https://www.andreagrandi.it/tag/rest.html">rest</a>
<a href="https://www.andreagrandi.it/tag/tutorial.html">tutorial</a>
</p>
</div>
<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'andrea-grandi-it';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>
<footer>
<p>
  © 2024  - This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>
  Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme - source code available on <a href="https://github.com/andreagrandi/andreagrandi.it" target="_blank">GitHub</a>
</p><p>
<a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" target="_blank">
<img alt="Creative Commons License" height="15" src="/images/by-sa.png" style="border-width:0" title="Creative Commons License" width="80">
</img></a>
</p> </footer>
</main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Andrea Grandi ",
  "url" : "https://www.andreagrandi.it",
  "image": "/images/me_pycon_2019_2_300x300.jpg",
  "description": ""
}
</script>
<script>
    $(document).ready(function () {
      $('#tipue_search_input').tipuesearch();
    });
  </script>
</body>
</html>