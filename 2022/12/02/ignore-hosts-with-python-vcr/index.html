
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="robots"/>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&amp;family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&amp;display=swap" rel="stylesheet"/>
<link href="https://www.andreagrandi.it/theme/stylesheet/style.min.css" rel="stylesheet" type="text/css"/>
<link href="https://www.andreagrandi.it/theme/pygments/monokai.min.css" id="pygments-light-theme" rel="stylesheet" type="text/css"/>
<script src="https://www.andreagrandi.it/theme/tipuesearch/jquery.min.js"></script>
<script defer="" src="https://www.andreagrandi.it/theme/tipuesearch/tipuesearch.min.js"></script>
<script defer="" src="https://www.andreagrandi.it/theme/tipuesearch/tipuesearch_set.js"></script>
<script defer="" src="https://www.andreagrandi.it/tipuesearch_content.js"></script>
<link href="https://www.andreagrandi.it/theme/tipuesearch/tipuesearch.min.css" rel="stylesheet">
<link href="https://www.andreagrandi.it/theme/font-awesome/css/fontawesome.css" rel="stylesheet" type="text/css"/>
<link href="https://www.andreagrandi.it/theme/font-awesome/css/brands.css" rel="stylesheet" type="text/css"/>
<link href="https://www.andreagrandi.it/theme/font-awesome/css/solid.css" rel="stylesheet" type="text/css"/>
<link href="https://www.andreagrandi.it/feeds/all.rss.xml" rel="alternate" title="Andrea Grandi RSS" type="application/rss+xml"/>
<!-- Chrome, Firefox OS and Opera -->
<meta content="#333333" name="theme-color"/>
<!-- Windows Phone -->
<meta content="#333333" name="msapplication-navbutton-color"/>
<!-- iOS Safari -->
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<!-- Microsoft EDGE -->
<meta content="#333333" name="msapplication-TileColor"/>
<meta content="Andrea Grandi" name="author">
<meta content="How to ignore hosts with python vcr when writing tests with pytest and generating cassettes" name="description">
<meta content="python, development, python-vcr, programming, tests, pytest, vcr" name="keywords"/>
<meta content="Andrea Grandi" property="og:site_name">
<meta content="Ignoring hosts with python vcr when writing tests with pytest and generating cassettes" property="og:title">
<meta content="How to ignore hosts with python vcr when writing tests with pytest and generating cassettes" property="og:description">
<meta content="en_US" property="og:locale">
<meta content="https://www.andreagrandi.it/2022/12/02/ignore-hosts-with-python-vcr/" property="og:url"/>
<meta content="article" property="og:type"/>
<meta content="2022-12-02 11:30:00+01:00" property="article:published_time"/>
<meta content="" property="article:modified_time"/>
<meta content="https://www.andreagrandi.it/author/andrea-grandi.html" property="article:author"/>
<meta content="Development" property="article:section">
<meta content="python" property="article:tag"/>
<meta content="development" property="article:tag"/>
<meta content="python-vcr" property="article:tag"/>
<meta content="programming" property="article:tag"/>
<meta content="tests" property="article:tag"/>
<meta content="pytest" property="article:tag"/>
<meta content="vcr" property="article:tag"/>
<meta content="/images/me_pycon_2019_2_300x300.jpg" property="og:image"/>
<title>Andrea Grandi â€“ Ignoring hosts with python vcr when writing tests with pytest and generating cassettes</title>
<link href="https://www.andreagrandi.it/2022/12/02/ignore-hosts-with-python-vcr/" rel="canonical">
<link href="https://mastodon.social/@andreagrandi" rel="me">
</link></link></meta></meta></meta></meta></meta></meta></meta></link><link href="https://www.andreagrandi.it/2022/12/02/ignore-hosts-with-python-vcr/" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "Andrea Grandi", "item": "https://www.andreagrandi.it"}, {"@type": "ListItem", "position": 2, "name": "2022", "item": "https://www.andreagrandi.it/2022"}, {"@type": "ListItem", "position": 3, "name": "12", "item": "https://www.andreagrandi.it/2022/12"}, {"@type": "ListItem", "position": 4, "name": "02", "item": "https://www.andreagrandi.it/2022/12/02"}, {"@type": "ListItem", "position": 5, "name": "Ignore hosts with python vcr", "item": "https://www.andreagrandi.it/2022/12/02/ignore-hosts-with-python-vcr"}, {"@type": "ListItem", "position": 6, "name": "Index", "item": "https://www.andreagrandi.it/2022/12/02/ignore-hosts-with-python-vcr/index.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Andrea Grandi"}, "publisher": {"@type": "Organization", "name": "Andrea Grandi"}, "headline": "Ignoring hosts with python vcr when writing tests with pytest and generating cassettes", "about": "Development", "datePublished": "2022-12-02 11:30"}</script></head>
<body class="light-theme">
<aside>
<div>
<a href="https://www.andreagrandi.it">
<img alt="Andrea Grandi" src="/images/me_pycon_2019_2_300x300.jpg" title="Andrea Grandi"/>
</a>
<h1>
<a href="https://www.andreagrandi.it">Andrea Grandi</a>
</h1>
<p>Software Developer</p>
<form action="/search.html" class="navbar-search" role="search">
<input id="tipue_search_input" name="q" placeholder="Search..." type="text"/>
</form>
<nav>
<ul class="list">
<li>
<a href="https://www.andreagrandi.it/about/" target="_self">
              About
            </a>
</li>
<li>
<a href="https://www.andreagrandi.it/curriculum/" target="_self">
              Curriculum
            </a>
</li>
<li>
<a href="https://www.andreagrandi.it/pgp-key/" target="_self">
              PGP Key
            </a>
</li>
</ul>
</nav>
<ul class="social">
<li>
<a class="sc-mastodon" href="https://mastodon.social/@andreagrandi" rel="me" target="_blank">
<i class="fab fa-mastodon"></i>
</a>
</li>
<li>
<a class="sc-github" href="https://github.com/andreagrandi" target="_blank">
<i class="fab fa-github"></i>
</a>
</li>
<li>
<a class="sc-linkedin" href="https://www.linkedin.com/in/andreagrandi/" target="_blank">
<i class="fab fa-linkedin"></i>
</a>
</li>
</ul>
</div>
<a href="https://tree-nation.com/profile/impact/andreagrandi#co2" style="position:relative;cursor:pointer;display:block;z-index:999;" target="_blank">
<img src="https://tree-nation.com/images/tracking/label-co2-website-white-en.png" style="width:157px;height:auto;"/>
</a>
<script src="https://tree-nation.com/js/track.js"></script>
<script>treenation_track("63a8beb06e6e6");</script>
</aside>
<main>
<nav>
<a href="https://www.andreagrandi.it">Home</a>
<a href="/archives.html">Archives</a>
<a href="/categories.html">Categories</a>
<a href="/tags.html">Tags</a>
<a href="https://www.andreagrandi.it/feeds/all.rss.xml">RSS</a>
</nav>
<article class="single">
<header>
<h1 id="ignore-hosts-with-python-vcr">Ignoring hosts with python vcr when writing tests with pytest and generating cassettes</h1>
<p>
      Posted on Fri 02 December 2022 in <a href="https://www.andreagrandi.it/category/development.html">Development</a>
</p>
</header>
<div>
<p>If you are already using <a href="https://pytest.org">pytest</a> to write your tests and are also using <a href="https://vcrpy.readthedocs.io">vcr</a>
to record and replay http responses, you already know that any http request is being recorded, so the next time the same
request is made, the test won't hit the real endpoint but it will use the recorded response.</p>
<p>Sometimes you need to exclude <code>localhost</code> (or other hosts) from being recorded and you can do thanks to this vcr parameter:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">vcr</span><span class="p">(</span><span class="n">ignore_hosts</span><span class="o">=</span><span class="p">[</span><span class="s2">"localhost"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_is_true</span><span class="p">():</span>
    <span class="c1"># Intentionally dumb test to make things simple</span>
    <span class="k">assert</span> <span class="kc">True</span>
</code></pre></div>
<p>This works, but what if you have many tests and you want to ignore <code>localhost</code> globally?</p>
<p>You can do it by adding this to your main <code>conftest.py</code> and all your vcr tests will ignore it by default:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"module"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">vcr_config</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">"ignore_hosts"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"localhost"</span><span class="p">],</span>
    <span class="p">}</span>
</code></pre></div>
<p>That's it! I hope you find this suggestion useful.</p>
</div>
<div class="tag-cloud">
<p>
<a href="https://www.andreagrandi.it/tag/python.html">python</a>
<a href="https://www.andreagrandi.it/tag/development.html">development</a>
<a href="https://www.andreagrandi.it/tag/python-vcr.html">python-vcr</a>
<a href="https://www.andreagrandi.it/tag/programming.html">programming</a>
<a href="https://www.andreagrandi.it/tag/tests.html">tests</a>
<a href="https://www.andreagrandi.it/tag/pytest.html">pytest</a>
<a href="https://www.andreagrandi.it/tag/vcr.html">vcr</a>
</p>
</div>
<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'andrea-grandi-it';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>
<footer>
<p>
  Â© 2024  - This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>
  Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme - source code available on <a href="https://github.com/andreagrandi/andreagrandi.it" target="_blank">GitHub</a>
</p><p>
<a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" target="_blank">
<img alt="Creative Commons License" height="15" src="/images/by-sa.png" style="border-width:0" title="Creative Commons License" width="80">
</img></a>
</p> </footer>
</main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Andrea Grandi ",
  "url" : "https://www.andreagrandi.it",
  "image": "/images/me_pycon_2019_2_300x300.jpg",
  "description": ""
}
</script>
<script>
    $(document).ready(function () {
      $('#tipue_search_input').tipuesearch();
    });
  </script>
</body>
</html>